{
  "version": "Notebook/1.0",
  "items": [
    {
      "type": 1,
      "content": {
        "json": "# FinOps Insights - Workbook"
      },
      "name": "overview"
    },
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "crossComponentResources": [
          "{Subscription}"
        ],
        "parameters": [
          {
            "id": "51aa3a9b-14e0-4c22-a60d-abdbf8813f00",
            "version": "KqlParameterItem/1.0",
            "name": "Subscription",
            "type": 6,
            "isRequired": true,
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "typeSettings": {
              "additionalResourceOptions": [
                "value::all"
              ],
              "includeAll": true,
              "showDefault": false
            },
            "timeContext": {
              "durationMs": 86400000
            },
            "defaultValue": "value::all"
          },
          {
            "id": "671d9428-695b-4ff3-bc5c-5a951cd14b06",
            "version": "KqlParameterItem/1.0",
            "name": "TimeRange",
            "type": 4,
            "typeSettings": {
              "selectableValues": [
                {
                  "durationMs": 3600000
                },
                {
                  "durationMs": 14400000
                },
                {
                  "durationMs": 43200000
                },
                {
                  "durationMs": 86400000
                },
                {
                  "durationMs": 172800000
                },
                {
                  "durationMs": 259200000
                },
                {
                  "durationMs": 604800000
                },
                {
                  "durationMs": 1209600000
                },
                {
                  "durationMs": 2419200000
                },
                {
                  "durationMs": 2592000000
                },
                {
                  "durationMs": 5184000000
                },
                {
                  "durationMs": 7776000000
                }
              ]
            },
            "value": {
              "durationMs": 172800000
            }
          },
          {
            "id": "adfb0a0a-b593-4dbd-8591-985d06b2c669",
            "version": "KqlParameterItem/1.0",
            "name": "StorageAccounts",
            "type": 5,
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "query": "where type =~ 'microsoft.storage/storageaccounts'\r\n| order by name asc\r\n| extend Rank = row_number()\r\n| project value = id, label = id, selected = Rank <= 5",
            "crossComponentResources": [
              "{Subscription}"
            ],
            "isHiddenWhenLocked": true,
            "typeSettings": {
              "additionalResourceOptions": [
                "value::all"
              ],
              "showDefault": false
            },
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources",
            "value": [
              "value::all"
            ]
          },
          {
            "id": "acfb0b0b-5af5-4c24-94a9-352aa1360151",
            "version": "KqlParameterItem/1.0",
            "name": "LogAnalyticsWorkspace",
            "type": 5,
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "query": "resources\r\n| where type == \"microsoft.operationalinsights/workspaces\"\r\n| project id, name",
            "crossComponentResources": [
              "{Subscription}"
            ],
            "isHiddenWhenLocked": true,
            "typeSettings": {
              "additionalResourceOptions": [
                "value::all"
              ],
              "showDefault": false
            },
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources",
            "value": [
              "value::all"
            ]
          },
          {
            "id": "e2cecc14-1c84-4871-8b40-0fe735a19175",
            "version": "KqlParameterItem/1.0",
            "name": "VPNGateways",
            "type": 5,
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "query": "Resources \r\n| where type =~ \"microsoft.network/virtualnetworkgateways\" and properties.gatewayType == \"Vpn\"\r\n| project id",
            "crossComponentResources": [
              "{Subscription}"
            ],
            "isHiddenWhenLocked": true,
            "typeSettings": {
              "additionalResourceOptions": [
                "value::all"
              ],
              "showDefault": false
            },
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources",
            "value": [
              "value::all"
            ]
          },
          {
            "id": "8284245f-5752-4258-ab07-aa48747a43da",
            "version": "KqlParameterItem/1.0",
            "name": "Firewalls",
            "type": 5,
            "multiSelect": true,
            "quote": "'",
            "delimiter": ",",
            "query": "resources\r\n| where type == \"microsoft.network/azurefirewalls\"\r\n| project id",
            "crossComponentResources": [
              "{Subscription}"
            ],
            "isHiddenWhenLocked": true,
            "typeSettings": {
              "additionalResourceOptions": [
                "value::all"
              ],
              "showDefault": false
            },
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources",
            "value": [
              "value::all"
            ]
          }
        ],
        "style": "pills",
        "queryType": 1,
        "resourceType": "microsoft.resourcegraph/resources"
      },
      "conditionalVisibility": {
        "parameterName": "SelectedTab",
        "comparison": "isNotEqualTo",
        "value": "CostInformation"
      },
      "name": "parameters - 0"
    },
    {
      "type": 11,
      "content": {
        "version": "LinkItem/1.0",
        "style": "tabs",
        "links": [
          {
            "id": "0d7b7a29-9226-4420-a05f-783c27342e8e",
            "cellValue": "mainTab",
            "linkTarget": "parameter",
            "linkLabel": "Overview",
            "subTarget": "overview",
            "style": "link"
          },
          {
            "id": "1f70f0f3-465a-4736-8d2f-a323fe764bdf",
            "cellValue": "mainTab",
            "linkTarget": "parameter",
            "linkLabel": "Governance",
            "subTarget": "governance",
            "style": "link"
          },
          {
            "id": "c69456aa-4261-4c08-a7ef-be1db076b9f5",
            "cellValue": "mainTab",
            "linkTarget": "parameter",
            "linkLabel": "Visualization",
            "subTarget": "visualization",
            "style": "link"
          },
          {
            "id": "e23aecd2-e6be-4e2e-9339-baad8e6f0440",
            "cellValue": "mainTab",
            "linkTarget": "parameter",
            "linkLabel": "Cost Optimization",
            "subTarget": "costOpt",
            "style": "link"
          },
          {
            "id": "cdefeb77-cd99-4ff3-8591-403e6b6e31c4",
            "cellValue": "mainTab",
            "linkTarget": "parameter",
            "linkLabel": "Practical Examples",
            "subTarget": "practicalExamples",
            "style": "link"
          }
        ]
      },
      "name": "links - 8"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "# Visualization\r\n\r\nTo ensure that a FinOps initiative is successful, the costs need to be visualized, tracked and understood. It's also imperitive to monitor the effectiveness of any Governance and FinOps automation. \r\n\r\n### Tools\r\n\r\nAzure Costs can be visualized by different tools. Each tool has it's own pros and cons. The below table provides generalised guidance for each tool. \r\n\r\n| Tool | Overview | Pros | Cons |\r\n| -- | -- | -- | -- |\r\n| Cost Management & Billing Service | This is the built in Azure billing tool and is available out of the box for free, for all Azure accounts. <br> <br> [Cost Management Tutorial](https://learn.microsoft.com/en-us/azure/cost-management-billing/costs/quick-acm-cost-analysis) | - Free <br> - Pre-configured and ready to use <br> - Can deep dive into Azure Costs | - Requires Azure RBAC access <br> - Requires the user to use the Azure Portal (may not be ideal for management) <br> - No out-of the box emailed report |\r\n| PowerBI | Power BI is a collection of software services, apps, and connectors that work together to turn your unrelated sources of data into coherent, visually immersive, and interactive insights. Your data may be an Excel spreadsheet, or a collection of cloud-based and on-premises hybrid data warehouses. Power BI lets you easily connect to your data sources, visualize and discover what's important, and share that with anyone or everyone you want. <br> <br> [What Is PowerBI](https://learn.microsoft.com/en-us/power-bi/fundamentals/power-bi-overview) <br> [How to connect PowerBI to Azure Cost Management](https://learn.microsoft.com/en-us/power-bi/connect-data/desktop-connect-azure-cost-management) | - Curated views of data <br> - Scheduled Publishing of reports <br> - Shared organization view <br> - Can combine data from multi data sources <br> - Great for executives & non-technical people | - Requires additional licenses <br> - Requires setup to work <br> - Requires PowerBI skills to customise |\r\n| Azure Policy | Azure Policy is an Azure service that helps to enforce organizational standards and to assess compliance at-scale. <br> <br> [What is Azure Policy](https://learn.microsoft.com/en-us/azure/governance/policy/overview) | - Can audit and enforce FinOps standards <br> - Can automatically remediate Azure resources <br> | - Requires additional setup <br> - Requires hands on technical skills |\r\n\r\n<br>\r\n"
            },
            "name": "text - 0"
          },
          {
            "type": 1,
            "content": {
              "json": "## Tips\r\n\r\nWhen starting the FinOps journey, it's recommended to understand the current Cloud costs. This can be done by using the Cost Management & Billing service in Azure. \r\n\r\n1. Ensure costs can be tied to a tracked to a business entity`(department | team | business unit | Project)`. \r\n  - This is usually done by using `Tags` or `Boundaries (Subscriptions | resource groups)`. \r\n2. Look at the costs by Azure Services (review the top `5 most expensive services`).\r\n3. Assess the costs by Azure Resources (What are the `10 most expensive services`).\r\n4. Send out a monthly report to key stakeholders to ensure the costs are understood. \r\n  - Offer time to run the teams through the report so they can understand their costs and any opportunities to optimize their spend. \r\n5. Visualize Reservations, Savings Plans, Budgets and costs. \r\n6. Track budget alert frequency and if the alerts are being actioned. \r\n7. Identify if a charge back model will be implemented. \r\n\r\n"
            },
            "name": "text - 1",
            "styleSettings": {
              "padding": "10px",
              "showBorder": true
            }
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "mainTab",
        "comparison": "isEqualTo",
        "value": "visualization"
      },
      "name": "visualizationGroup"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "tabs",
              "links": [
                {
                  "id": "ba6b341a-b02c-4db6-9bd8-b8fd2fa40ccb",
                  "cellValue": "govTab",
                  "linkTarget": "parameter",
                  "linkLabel": "Tagging",
                  "subTarget": "tagging",
                  "style": "link"
                },
                {
                  "id": "16528230-6640-4cc0-a778-4f3552ca21c1",
                  "cellValue": "govTab",
                  "linkTarget": "parameter",
                  "linkLabel": "Azure Advisor",
                  "subTarget": "advisor",
                  "preText": "Azure Advisor",
                  "style": "link"
                },
                {
                  "id": "38c6d187-77fe-402b-b8dd-fcd38fe69136",
                  "cellValue": "govTab",
                  "linkTarget": "parameter",
                  "linkLabel": "Hybrid Licensing",
                  "subTarget": "hybrid",
                  "style": "link"
                },
                {
                  "id": "f5d1f60b-2277-4eeb-81ab-2f9665574cfb",
                  "cellValue": "govTab",
                  "linkTarget": "parameter",
                  "linkLabel": "Budgets",
                  "subTarget": "budgets",
                  "style": "link"
                }
              ]
            },
            "name": "links - 3"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "![budgets-icon](https://finopsworkbookcontent.blob.core.windows.net/finops-workbook/Cost-Budgets-small.png)\r\n\r\n# Budgets\r\n\r\nAzure Budgets provide the ability to proactively manage Cloud costs. Budgets can be used to `forecast` spend and to remediate any unexpected costs, before the bill comes through. \r\n\r\nBudgets can be created automatically through [Infrastructure As Code (IaC)](https://learn.microsoft.com/en-us/azure/templates/microsoft.costmanagement/budgets?pivots=deployment-language-bicep) or using an [Azure Runbook (example)](https://nbnm.medium.com/automate-creating-budgets-for-resource-groups-in-azure-81dd9d59cce7) to apply default Budgets based on resource tags. \r\n\r\nBudgets need to be assessed on a cadence and potentially modified as usage grows.\r\n\r\n\r\n> **[Budget Tutorial](https://learn.microsoft.com/en-us/azure/cost-management-billing/costs/tutorial-acm-create-budgets)**\r\n<br>\r\n\r\n> **This Workbook is unable to show Budgets, so navigate to the [Budget](https://ms.portal.azure.com/#view/Microsoft_Azure_CostManagement/Menu/~/budgets/open/budgets/openedBy/AzurePortal) view in Azure. **\r\n\r\n<br>\r\n## Budget Example\r\n\r\n"
                  },
                  "name": "text - 0"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "![budgetExample](https://finopsworkbookcontent.blob.core.windows.net/finops-workbook/budget-set-alert-example-60.png)"
                  },
                  "name": "text - 1",
                  "styleSettings": {
                    "showBorder": true
                  }
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "govTab",
              "comparison": "isEqualTo",
              "value": "budgets"
            },
            "name": "budgetGroup"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# Hybrid Licensing\r\n\r\nFor customers with Software Assurance, Azure Hybrid Benefit allows you to apply your on-premises licenses for resources running in on Azure. \r\n\r\nThis benefit is applicable for Microsoft SQL servers (VMs, Managed and Server) aswell as Windows  and Rhel Virtual Machines.  \r\n\r\n\r\n> **[Azure Hybrid Benefit for Windows Server licensing page](https://azure.microsoft.com/pricing/hybrid-use-benefit/)** <br>\r\n> **[Azure Hybrid Benefit for SQL](https://learn.microsoft.com/en-us/azure/azure-sql/azure-hybrid-benefit?view=azuresql&tabs=azure-portal)** <br>\r\n> **[Azure Hybrid Benefit Savings Calculation](https://azure.microsoft.com/en-gb/pricing/hybrid-benefit/#calculator)** <br> \r\n> **[Centrally Manage Hybrid Benefits in Azure](https://learn.microsoft.com/en-gb/azure/cost-management-billing/scope-level/)**<br> <br>\r\n> **Important: Always check and ensure you have available licenses before turning Hybrid Benefits on.**\r\n"
                  },
                  "name": "text - 5"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "title": "Virtual Machines",
                    "expandable": true,
                    "items": [
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "resources \r\n| where type =~ 'microsoft.compute/virtualmachines' and (properties.storageProfile.imageReference.publisher == 'suse' or properties.storageProfile.imageReference.publisher=='RedHat')\r\n| where tostring(properties.['licenseType']) != 'SLES_BYOS' and tostring(properties.['licenseType']) != 'RHEL_BYOS' \r\n| extend WindowsId=id, VMName=name, VMLocation=location, VMRG=resourceGroup, OSType=tostring(properties.storageProfile.imageReference.offer), OsVersion = tostring(properties.storageProfile.imageReference.sku), VMSize=tostring (properties.hardwareProfile.vmSize), LicenseType = tostring(properties.['licenseType']) \r\n    | order by VMSize asc \r\n    | project WindowsId,VMName,VMRG, VMLocation,OSType, OsVersion,LicenseType, VMSize",
                          "size": 1,
                          "title": "Linux VMs without Azure Hybrid Benefit enabled",
                          "noDataMessage": "All applicable Linux VMs have the Azure Hybrid Benefit enabled",
                          "noDataMessageStyle": 3,
                          "showExportToExcel": true,
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ]
                        },
                        "name": "query - 2"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "resources \r\n| where type =~ 'microsoft.compute/virtualmachines' or type =~ 'microsoft.compute/virtualMachineScaleSets'\r\n| where tostring(properties.storageProfile.osDisk.osType) == 'Windows' or tostring(properties.virtualMachineProfile.storageProfile.osDisk.osType) == 'Windows'\r\n| where tostring(properties.['licenseType']) !has 'Windows' and tostring(properties.virtualMachineProfile.['licenseType']) !has 'Windows'\r\n| extend WindowsId=id, VMName=name, VMLocation=location, VMRG=resourceGroup, OSType=tostring(properties.storageProfile.imageReference.offer), OsVersion = tostring(properties.storageProfile.imageReference.sku), VMSize=tostring (properties.hardwareProfile.vmSize), LicenseType = tostring(properties.['licenseType'])\r\n| order by type asc \r\n| project WindowsId,VMName,VMRG,VMSize, VMLocation,OSType, OsVersion,LicenseType",
                          "size": 1,
                          "title": "Windows VMs and VM scale sets without Azure Hybrid Benefit enabled",
                          "noDataMessage": "All Windows VMs and VM scale sets have the Azure Hybrid Benefit enabled",
                          "noDataMessageStyle": 3,
                          "showExportToExcel": true,
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "gridSettings": {
                            "rowLimit": 1000
                          }
                        },
                        "name": "query - 1"
                      }
                    ]
                  },
                  "name": "vm",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "title": "Microsoft SQL Servers",
                    "expandable": true,
                    "items": [
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "ResourceContainers\r\n| where type =~ 'Microsoft.Resources/subscriptions' \r\n| extend SubscriptionName=name | join (resources |  where type =~ 'Microsoft.Sql/servers/databases' and name != 'master' and tostring(properties.['licenseType']) == 'LicenseIncluded' \r\n| extend   SQLDBID=id,SQLName = name, SQLRG = resourceGroup, SKUName=sku.name, SKUTier=sku.tier, SQLLocation = location, LicenseType = tostring(properties.['licenseType']), StorageAccountType=tostring(properties.['storageAccountType'])) on subscriptionId \r\n| project SQLDBID,SQLName,SQLRG, SKUName, SKUTier, SQLLocation, LicenseType, StorageAccountType, SubscriptionName",
                          "size": 1,
                          "title": "Azure SQL Databases not using Hybrid Benefit",
                          "noDataMessage": "The query returned no results. There 2 reasons for that 1) All of your SQL Databases are using Hybrid benefit or 2) There are no SQL Databases deployed in this scope.",
                          "noDataMessageStyle": 3,
                          "showExportToExcel": true,
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ]
                        },
                        "name": "query - 1"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "ResourceContainers\r\n | where type =~ 'Microsoft.Resources/subscriptions' \r\n | extend SubscriptionName=name \r\n | join (resources |  where type =~ 'Microsoft.Sql/managedInstances' and tostring(properties.['licenseType']) == 'LicenseIncluded'\r\n | extend ManagedInstance=id, SQLRG=resourceGroup, SQLLocation=location, LicenseType = tostring(properties.['licenseType'])) on subscriptionId \r\n | project ManagedInstance,SQLRG, SQLLocation, LicenseType, SubscriptionName",
                          "size": 1,
                          "title": "Azure SQL Managed Instances not using Hybrid Benefit",
                          "noDataMessage": "The query returned no results. There 2 reasons for that 1) All of your SQL Managed Instances are using Hybrid benefit or 2) There are no SQL Managed Instances  deployed in this scope.",
                          "noDataMessageStyle": 3,
                          "showExportToExcel": true,
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ]
                        },
                        "name": "query - 2"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "ResourceContainers | where type =~ 'Microsoft.Resources/subscriptions' | extend SubscriptionName=name | join ( resources | where type =~ 'Microsoft.SqlVirtualMachine/SqlVirtualMachines' and tostring(properties.['sqlServerLicenseType']) != 'AHUB'  | extend SQLID=id, VMName = name, VMRG = resourceGroup, VMLocation = location, LicenseType = tostring(properties.['sqlServerLicenseType']), OSType=tostring(properties.storageProfile.imageReference.offer), SQLAgentType = tostring(properties.['sqlManagement']), SQLVersion = tostring(properties.['sqlImageOffer']), SQLSKU=tostring(properties.['sqlImageSku'])) on subscriptionId \r\n    | order by id asc    \r\n    | project SQLID,VMName,VMRG, VMLocation, SQLVersion, SQLSKU, SQLAgentType, LicenseType, SubscriptionName\r\n    | where  SQLSKU != \"Developer\" and SQLSKU != \"Express\"",
                          "size": 1,
                          "title": "SQL Virtual Machines not using Hybrid Benefit",
                          "noDataMessage": "The query returned no results. There 2 reasons for that 1) All of your SQL Virtual Machines are using Hybrid benefit (For SQL) or 2) There are no SQL Virtual Machines deployed in this scope.",
                          "noDataMessageStyle": 3,
                          "showExportToExcel": true,
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ]
                        },
                        "name": "query - 3"
                      }
                    ]
                  },
                  "name": "sql",
                  "styleSettings": {
                    "showBorder": true
                  }
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "govTab",
              "comparison": "isEqualTo",
              "value": "hybrid"
            },
            "name": "costHybridGroup"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "![tag-icon](https://finopsworkbookcontent.blob.core.windows.net/finops-workbook/Tags-small.png)\r\n# Tagging\r\n\r\nResources and Resource Containers (subscriptions, ResourceGroups and Management Groups) can be tagged. Tags are metadata that provide additional information about resources running in the Cloud. When tracking costs in the Cloud, resource tags are crucial as you can add a tag for `Contact/Department/CostCentercost`. \r\n\r\nTagging data will flow through to the billing information and can be visualized in PowerBI or the Cost Management service. This allows for a clear breakdown of cost of resources running in the Cloud. \r\n\r\n## Examples\r\n\r\nYour organization should have a defined tagging standard and an understanding of how each tag (and value) will be used / why it's relevant. Be aware that some services in Azure have a `15 tag limit`. \r\n\r\n- **CostCenter:** How can I find the cost center ID internally? \r\n- **Contacts:** Technical and Business contact for the owner of the workload. \r\n\r\n### Usage Examples\r\n\r\n- **Good Example**: Use the `vendorContact` tag if  a vendor manages or supports a workload, consider adding a tag \r\n- **Bad Example**: A tag `applicationLayer` provides no real context or value to the solution.   \r\n\r\n## Audit\r\n\r\n- This page reviews the tagging keys used and identifies any untagged (resources/resource groups / subscriptions). \r\n- Unique keys help to visualize any tagging governance used. It's also important to ensure that the values are consistent (e.g. `environment: dev` and `environment: Development`)\r\n\r\n> **[For help and guidance on tagging](https://learn.microsoft.com/en-us/azure/cloud-adoption-framework/ready/azure-best-practices/resource-naming)** \r\n<br>\r\n> **[Guidance to reconcile tagging](https://techcommunity.microsoft.com/t5/core-infrastructure-and-security/reconcile-tag-names-across-azure/ba-p/3453172)**\r\n<br>\r\n> **[Tag Resources with their Creators name](https://techcommunity.microsoft.com/t5/core-infrastructure-and-security/tagging-azure-resources-with-a-creator/ba-p/1479819)**"
                  },
                  "name": "text - 2"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "title": "Tag Usage Overview",
                    "items": [
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "ResourceContainers\r\n| where type =~ 'microsoft.resources/subscriptions/resourcegroups'\r\n| extend TagBool = iff(tags != '' and tags != '[]', \"Tagged\",\"Untagged\")\r\n| summarize count() by TagBool\r\n//| project resourceGroup, tags\r\n",
                          "size": 1,
                          "title": "Tagged Resource Groups",
                          "exportFieldName": "resourceGroupTag",
                          "exportParameterName": "resourceGroupTag",
                          "showExportToExcel": true,
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "visualization": "piechart"
                        },
                        "customWidth": "50",
                        "name": "query - 3"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "Resources | extend TagBool = iff(tags != '' and tags != '[]', \"Tagged\",\"Untagged\") | summarize count() by TagBool\r\n\r\n",
                          "size": 1,
                          "title": "Untagged Resource Count",
                          "showExportToExcel": true,
                          "queryType": 1,
                          "resourceType": "microsoft.operationalinsights/workspaces",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "visualization": "piechart"
                        },
                        "customWidth": "50",
                        "name": "query - 7"
                      }
                    ]
                  },
                  "name": "overview",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "title": "Resources",
                    "items": [
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "resources \r\n| mvexpand tags\r\n| where tags == '' or isempty(tags)\r\n| project Name=id, subscriptionId\r\n| summarize count()\r\n\r\n",
                          "size": 4,
                          "title": "Untagged Resources",
                          "noDataMessage": "No Untagged Resources found",
                          "noDataMessageStyle": 3,
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "visualization": "tiles",
                          "gridSettings": {
                            "rowLimit": 1000
                          },
                          "tileSettings": {
                            "titleContent": {},
                            "leftContent": {
                              "columnMatch": "count_",
                              "formatter": 12,
                              "formatOptions": {
                                "max": 200,
                                "palette": "red"
                              }
                            },
                            "showBorder": false
                          }
                        },
                        "customWidth": "20",
                        "name": "query - 10"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "resources \r\n| mvexpand tags\r\n| where tags != '' or isnotempty(tags)\r\n| extend tagKey = tostring(bag_keys(tags)[0])\r\n| extend tagValue = tostring(tags[tagKey])\r\n| project tagKey, tagValue\r\n| distinct tagKey\r\n| summarize count()\r\n\r\n",
                          "size": 4,
                          "title": "Unique Resource Tag Keys",
                          "noDataMessage": "No Untagged Resources found",
                          "noDataMessageStyle": 3,
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "visualization": "tiles",
                          "gridSettings": {
                            "rowLimit": 5000
                          },
                          "tileSettings": {
                            "titleContent": {},
                            "leftContent": {
                              "columnMatch": "count_",
                              "formatter": 12,
                              "formatOptions": {
                                "max": 200,
                                "palette": "blue"
                              }
                            },
                            "showBorder": false
                          }
                        },
                        "customWidth": "20",
                        "name": "query - 10 - Copy"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "resources \r\n| mvexpand tags\r\n| where tags != '' or isnotempty(tags)\r\n| extend tagKey = tostring(bag_keys(tags)[0])\r\n| extend tagValue = tostring(tags[tagKey])\r\n| project tagKey, tagValue\r\n| distinct tagKey, tagValue\r\n\r\n",
                          "size": 0,
                          "showAnalytics": true,
                          "title": "Unique Resource Tags",
                          "noDataMessage": "No Untagged Resources found",
                          "noDataMessageStyle": 3,
                          "showExportToExcel": true,
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "visualization": "table",
                          "gridSettings": {
                            "rowLimit": 5000
                          },
                          "tileSettings": {
                            "titleContent": {},
                            "leftContent": {
                              "columnMatch": "count_",
                              "formatter": 12,
                              "formatOptions": {
                                "max": 200,
                                "palette": "blue"
                              }
                            },
                            "showBorder": false
                          }
                        },
                        "customWidth": "50",
                        "name": "query - 10 - Copy - Copy"
                      },
                      {
                        "type": 12,
                        "content": {
                          "version": "NotebookGroup/1.0",
                          "groupType": "editable",
                          "title": "Untagged Resources List",
                          "expandable": true,
                          "items": [
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "resources \r\n| mvexpand tags\r\n| where tags == '' or isempty(tags)\r\n| extend tagKey = tostring(bag_keys(tags)[0])\r\n| extend tagValue = tostring(tags[tagKey])\r\n| project name, type, resourceGroup\r\n\r\n",
                                "size": 0,
                                "showAnalytics": true,
                                "title": "Untagged Resources",
                                "noDataMessage": "No Untagged Resources found",
                                "noDataMessageStyle": 3,
                                "showExportToExcel": true,
                                "queryType": 1,
                                "resourceType": "microsoft.resourcegraph/resources",
                                "crossComponentResources": [
                                  "{Subscription}"
                                ],
                                "visualization": "table",
                                "gridSettings": {
                                  "rowLimit": 5000,
                                  "filter": true
                                },
                                "tileSettings": {
                                  "titleContent": {},
                                  "leftContent": {
                                    "columnMatch": "count_",
                                    "formatter": 12,
                                    "formatOptions": {
                                      "max": 200,
                                      "palette": "blue"
                                    }
                                  },
                                  "showBorder": false
                                }
                              },
                              "customWidth": "80",
                              "name": "query - 10 - Copy - Copy - Copy"
                            }
                          ]
                        },
                        "name": "untaggedResources"
                      }
                    ]
                  },
                  "name": "resources",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "title": "Resource Groups",
                    "items": [
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "ResourceContainers\r\n| where type =~ 'Microsoft.Resources/subscriptions' \r\n| extend SubscriptionName=name \r\n| join  ( ResourceContainers | where type =~ 'microsoft.resources/subscriptions/resourcegroups' | mvexpand tags | where tags == '' or isempty(tags) \r\n| extend resourceGroupName=id, RGLocation=location) on subscriptionId\r\n| project resourceGroupName, RGLocation, SubscriptionName\r\n| summarize count()\r\n",
                          "size": 4,
                          "title": "Untagged Resource Groups",
                          "noDataMessageStyle": 3,
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "visualization": "tiles",
                          "tileSettings": {
                            "titleContent": {},
                            "leftContent": {
                              "columnMatch": "count_",
                              "formatter": 12,
                              "formatOptions": {
                                "max": 1,
                                "palette": "red"
                              }
                            },
                            "showBorder": false
                          }
                        },
                        "customWidth": "20",
                        "name": "query - 10 - Copy"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "ResourceContainers\r\n| where type == \"microsoft.resources/subscriptions/resourcegroups\"\r\n| mvexpand tags\r\n| where tags != '' or isnotempty(tags)\r\n| extend tagKey = tostring(bag_keys(tags)[0])\r\n| extend tagValue = tostring(tags[tagKey])\r\n| project tagKey, tagValue\r\n| distinct tagKey\r\n| summarize count()\r\n",
                          "size": 4,
                          "title": "Unique Resource Group Tags Keys",
                          "noDataMessageStyle": 3,
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "visualization": "tiles",
                          "tileSettings": {
                            "titleContent": {},
                            "leftContent": {
                              "columnMatch": "count_",
                              "formatter": 12,
                              "formatOptions": {
                                "max": 50,
                                "palette": "blue"
                              }
                            },
                            "showBorder": false
                          }
                        },
                        "customWidth": "20",
                        "name": "query - 10 - Copy - Copy"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "ResourceContainers\r\n| where type == \"microsoft.resources/subscriptions/resourcegroups\"\r\n| mvexpand tags\r\n| where tags != '' or isnotempty(tags)\r\n| extend tagKey = tostring(bag_keys(tags)[0])\r\n| extend tagValue = tostring(tags[tagKey])\r\n| project tagKey, tagValue\r\n| distinct tagKey, tagValue\r\n",
                          "size": 0,
                          "showAnalytics": true,
                          "title": "Unique Resource Group Tags",
                          "noDataMessageStyle": 3,
                          "showExportToExcel": true,
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "visualization": "table",
                          "tileSettings": {
                            "titleContent": {},
                            "leftContent": {
                              "columnMatch": "count_",
                              "formatter": 12,
                              "formatOptions": {
                                "max": 50,
                                "palette": "blue"
                              }
                            },
                            "showBorder": false
                          }
                        },
                        "customWidth": "50",
                        "name": "query - 10 - Copy - Copy - Copy"
                      },
                      {
                        "type": 12,
                        "content": {
                          "version": "NotebookGroup/1.0",
                          "groupType": "editable",
                          "title": "Untagged Resource Groups List",
                          "expandable": true,
                          "items": [
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "ResourceContainers\r\n| where type == \"microsoft.resources/subscriptions/resourcegroups\"\r\n| mvexpand tags\r\n| where tags == '' or isempty(tags)\r\n| extend tagKey = tostring(bag_keys(tags)[0])\r\n| extend tagValue = tostring(tags[tagKey])\r\n| project name, subscriptionId\r\n",
                                "size": 0,
                                "showAnalytics": true,
                                "title": "Untagged Resource Groups",
                                "noDataMessage": "All Resource Groups are Tagged",
                                "noDataMessageStyle": 3,
                                "showExportToExcel": true,
                                "queryType": 1,
                                "resourceType": "microsoft.resourcegraph/resources",
                                "crossComponentResources": [
                                  "{Subscription}"
                                ],
                                "visualization": "table",
                                "gridSettings": {
                                  "formatters": [
                                    {
                                      "columnMatch": "name",
                                      "formatter": 14,
                                      "formatOptions": {
                                        "linkTarget": null,
                                        "showIcon": true
                                      }
                                    },
                                    {
                                      "columnMatch": "subscriptionId",
                                      "formatter": 15,
                                      "formatOptions": {
                                        "linkTarget": null,
                                        "showIcon": true
                                      }
                                    }
                                  ],
                                  "rowLimit": 2000,
                                  "filter": true
                                },
                                "tileSettings": {
                                  "titleContent": {},
                                  "leftContent": {
                                    "columnMatch": "count_",
                                    "formatter": 12,
                                    "formatOptions": {
                                      "max": 50,
                                      "palette": "blue"
                                    }
                                  },
                                  "showBorder": false
                                }
                              },
                              "customWidth": "50",
                              "name": "query - 10 - Copy - Copy - Copy - Copy"
                            }
                          ]
                        },
                        "name": "untaggedResourceGroups"
                      }
                    ]
                  },
                  "name": "resourceGroups",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "title": "Subscriptions",
                    "items": [
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "ResourceContainers\r\n| where type =~ 'Microsoft.Resources/subscriptions' \r\n| mvexpand tags\r\n| where tags == '' or isempty(tags)\r\n| summarize count()\r\n",
                          "size": 4,
                          "title": "Untagged Subscriptions",
                          "noDataMessageStyle": 3,
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "visualization": "tiles",
                          "tileSettings": {
                            "titleContent": {},
                            "leftContent": {
                              "columnMatch": "count_",
                              "formatter": 12,
                              "formatOptions": {
                                "max": 1,
                                "palette": "red"
                              }
                            },
                            "showBorder": false
                          }
                        },
                        "customWidth": "20",
                        "name": "query - 10 - Copy - Copy"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "ResourceContainers\r\n| where type =~ 'Microsoft.Resources/subscriptions' \r\n| mvexpand tags\r\n| where tags != '' or isnotempty(tags)\r\n| extend tagKey = tostring(bag_keys(tags)[0])\r\n| extend tagValue = tostring(tags[tagKey])\r\n| project tagKey, tagValue\r\n| distinct tagKey\r\n| summarize count()\r\n",
                          "size": 4,
                          "title": "Unique Subscriptions Tags Keys",
                          "noDataMessageStyle": 3,
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "visualization": "tiles",
                          "tileSettings": {
                            "titleContent": {},
                            "leftContent": {
                              "columnMatch": "count_",
                              "formatter": 12,
                              "formatOptions": {
                                "max": 50,
                                "palette": "blue"
                              }
                            },
                            "showBorder": false
                          }
                        },
                        "customWidth": "20",
                        "name": "query - 10 - Copy - Copy - Copy"
                      },
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "ResourceContainers\r\n| where type =~ 'Microsoft.Resources/subscriptions' \r\n| mvexpand tags\r\n| where tags != '' or isnotempty(tags)\r\n| extend tagKey = tostring(bag_keys(tags)[0])\r\n| extend tagValue = tostring(tags[tagKey])\r\n| project tagKey, tagValue\r\n| distinct tagKey, tagValue\r\n",
                          "size": 0,
                          "showAnalytics": true,
                          "title": "Unique Subscriptions Tags",
                          "noDataMessageStyle": 3,
                          "showExportToExcel": true,
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "visualization": "table",
                          "tileSettings": {
                            "titleContent": {},
                            "leftContent": {
                              "columnMatch": "count_",
                              "formatter": 12,
                              "formatOptions": {
                                "max": 50,
                                "palette": "blue"
                              }
                            },
                            "showBorder": false
                          }
                        },
                        "customWidth": "50",
                        "name": "query - 10 - Copy - Copy - Copy - Copy"
                      },
                      {
                        "type": 12,
                        "content": {
                          "version": "NotebookGroup/1.0",
                          "groupType": "editable",
                          "title": "Untagged Subscription List",
                          "expandable": true,
                          "items": [
                            {
                              "type": 3,
                              "content": {
                                "version": "KqlItem/1.0",
                                "query": "ResourceContainers\r\n| where type =~ 'Microsoft.Resources/subscriptions' \r\n| mvexpand tags\r\n| where tags == '' or isempty(tags)\r\n| extend tagKey = tostring(bag_keys(tags)[0])\r\n| extend tagValue = tostring(tags[tagKey])\r\n| project name\r\n",
                                "size": 0,
                                "showAnalytics": true,
                                "title": "Untagged Subscriptions",
                                "noDataMessage": "All subscriptions are tagged",
                                "noDataMessageStyle": 3,
                                "showExportToExcel": true,
                                "queryType": 1,
                                "resourceType": "microsoft.resourcegraph/resources",
                                "crossComponentResources": [
                                  "{Subscription}"
                                ],
                                "visualization": "table",
                                "gridSettings": {
                                  "filter": true
                                },
                                "tileSettings": {
                                  "titleContent": {},
                                  "leftContent": {
                                    "columnMatch": "count_",
                                    "formatter": 12,
                                    "formatOptions": {
                                      "max": 50,
                                      "palette": "blue"
                                    }
                                  },
                                  "showBorder": false
                                }
                              },
                              "customWidth": "50",
                              "name": "query - 10 - Copy - Copy - Copy - Copy - Copy"
                            }
                          ]
                        },
                        "name": "untaggedSubscriptions"
                      }
                    ]
                  },
                  "name": "subscriptions",
                  "styleSettings": {
                    "showBorder": true
                  }
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "govTab",
              "comparison": "isEqualTo",
              "value": "tagging"
            },
            "name": "taggingGroup"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "![advisor-logo](https://finopsworkbookcontent.blob.core.windows.net/finops-workbook/advisor-logo-small.png) \r\n\r\n# Azure Advisor\r\n\r\nAdvisor provides general cost savings recommendations for your workloads. These are `recommendations` that need to be investigated on a scheduled cadence. If the recommendations aren't applicable, they should be `suppressed`. \r\n\r\nFor a detailed view and to manage Advisor recommendations, open the **[Advisor](https://ms.portal.azure.com/#view/Microsoft_Azure_Expert/AdvisorMenuBlade/~/score)** service. \r\n\r\n> **[Advisor Overview](https://learn.microsoft.com/en-au/azure/advisor/advisor-overview)** <br>\r\n> **[Actioning Advisor Recommendations](https://learn.microsoft.com/en-us/azure/cost-management-billing/costs/tutorial-acm-opt-recommendations)** <br>\r\n> **[Guide to using Azure Advisor - Blog Post](https://techcommunity.microsoft.com/t5/azure-architecture-blog/3-reasons-to-optimize-your-workloads-with-azure-advisor/ba-p/3674044)**"
                  },
                  "name": "text - 1"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "advisorresources\r\n| where type == \"microsoft.advisor/recommendations\"\r\n| where tostring (properties.category) has \"Cost\"\r\n| where isnull(properties.suppressionIds) \r\n//| where properties.impactedField has \"Compute\" or properties.impactedField has \"Container\" or properties.impactedField has \"Web\"\r\n| project AffectedResource=tostring(properties.resourceMetadata.resourceId),Impact=properties.impact,resourceGroup,AdditionaInfo=properties.extendedProperties,subscriptionId,Recommendation=tostring(properties.shortDescription.problem)\r\n\r\n| summarize count()\r\n",
                    "size": 3,
                    "title": "Active Cost Recommendations",
                    "noDataMessage": "You are following all of our cost recommendations for Compute",
                    "noDataMessageStyle": 3,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Subscription}"
                    ],
                    "visualization": "tiles",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "subscriptionId",
                          "formatter": 15,
                          "formatOptions": {
                            "linkTarget": null,
                            "showIcon": true
                          }
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 5
                        }
                      ],
                      "rowLimit": 5000
                    },
                    "tileSettings": {
                      "titleContent": {},
                      "leftContent": {
                        "columnMatch": "count_",
                        "formatter": 12,
                        "formatOptions": {
                          "max": 50,
                          "palette": "blue"
                        }
                      },
                      "showBorder": false
                    }
                  },
                  "customWidth": "50",
                  "name": "query - 0 - Copy"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "advisorresources\r\n| where type == \"microsoft.advisor/recommendations\"\r\n| where properties.category == \"Cost\"\r\n| where isnotnull(properties.suppressionIds) \r\n| summarize count()",
                    "size": 3,
                    "title": "Suppressed Recommendations",
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Subscription}"
                    ],
                    "visualization": "tiles",
                    "tileSettings": {
                      "titleContent": {},
                      "leftContent": {
                        "columnMatch": "count_",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "blue"
                        }
                      },
                      "showBorder": false
                    }
                  },
                  "customWidth": "50",
                  "name": "query - 2"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "advisorresources\r\n| where type == \"microsoft.advisor/recommendations\"\r\n| where tostring (properties.category) has \"Cost\"\r\n\r\n| project AffectedResource=tostring(properties.resourceMetadata.resourceId),Impact=properties.impact,Recommendation=tostring(properties.shortDescription.problem), Message = properties.extendedProperties.recommendationMessage, ['Annual Savings'] = properties.extendedProperties.annualSavingsAmount,resourceGroup,subscriptionId //,AdditionaInfo=properties.extendedProperties",
                    "size": 3,
                    "title": "Azure Advisor Cost recommendations",
                    "noDataMessage": "You are following all of our cost recommendations for Compute",
                    "noDataMessageStyle": 3,
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Subscription}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "$gen_group",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "50%"
                          }
                        },
                        {
                          "columnMatch": "subscriptionId",
                          "formatter": 15,
                          "formatOptions": {
                            "linkTarget": null,
                            "showIcon": true
                          }
                        },
                        {
                          "columnMatch": "Recommendation",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "Annual Savings",
                          "formatter": 1,
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "currency": "USD",
                              "style": "currency"
                            }
                          }
                        },
                        {
                          "columnMatch": "$gen_group",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "50%"
                          }
                        }
                      ],
                      "rowLimit": 5000,
                      "filter": true,
                      "hierarchySettings": {
                        "treeType": 1,
                        "groupBy": [
                          "Recommendation"
                        ],
                        "expandTopLevel": false
                      }
                    }
                  },
                  "name": "query - 0"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "title": "Suppressed Advisor Recommendations",
                    "expandable": true,
                    "items": [
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "advisorresources\r\n| where type == \"microsoft.advisor/recommendations\"\r\n| where tostring (properties.category) has \"Cost\"\r\n| where isnotnull(properties.suppressionIds) \r\n| project AffectedResource=tostring(properties.resourceMetadata.resourceId),Impact=properties.impact,Recommendation=tostring(properties.shortDescription.problem), Message = properties.extendedProperties.recommendationMessage, ['Annual Savings'] = properties.extendedProperties.annualSavingsAmount,resourceGroup,subscriptionId //,AdditionaInfo=properties.extendedProperties",
                          "size": 3,
                          "noDataMessage": "No suppressed Advisor recommendations",
                          "noDataMessageStyle": 3,
                          "showExportToExcel": true,
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "$gen_group",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "50%"
                                }
                              },
                              {
                                "columnMatch": "subscriptionId",
                                "formatter": 15,
                                "formatOptions": {
                                  "linkTarget": null,
                                  "showIcon": true
                                }
                              },
                              {
                                "columnMatch": "Recommendation",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "Annual Savings",
                                "formatter": 1,
                                "numberFormat": {
                                  "unit": 0,
                                  "options": {
                                    "currency": "USD",
                                    "style": "currency"
                                  }
                                }
                              },
                              {
                                "columnMatch": "$gen_group",
                                "formatter": 0,
                                "formatOptions": {
                                  "customColumnWidthSetting": "50%"
                                }
                              }
                            ],
                            "rowLimit": 5000,
                            "filter": true,
                            "hierarchySettings": {
                              "treeType": 1,
                              "groupBy": [
                                "Recommendation"
                              ],
                              "expandTopLevel": false
                            }
                          }
                        },
                        "name": "query - 0 - Copy"
                      }
                    ]
                  },
                  "name": "supressedAdvisor"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "govTab",
              "comparison": "isEqualTo",
              "value": "advisor"
            },
            "name": "costAdvisorGroup"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "mainTab",
        "comparison": "isEqualTo",
        "value": "governance"
      },
      "name": "governanceGroup"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 11,
            "content": {
              "version": "LinkItem/1.0",
              "style": "tabs",
              "links": [
                {
                  "id": "792c094b-ce19-4e67-9280-b87f7936d48d",
                  "cellValue": "costTab",
                  "linkTarget": "parameter",
                  "linkLabel": "Orphan Resources",
                  "subTarget": "orphaned",
                  "style": "link"
                },
                {
                  "id": "497b0e83-1343-4754-9c62-71184f1414db",
                  "cellValue": "costTab",
                  "linkTarget": "parameter",
                  "linkLabel": "Log Analytics",
                  "subTarget": "logAnalytics",
                  "style": "link"
                },
                {
                  "id": "c398e1af-fce5-4708-a1e9-656e4491105c",
                  "cellValue": "costTab",
                  "linkTarget": "parameter",
                  "linkLabel": "StorageAccounts",
                  "subTarget": "storageAccounts",
                  "style": "link"
                },
                {
                  "id": "a7231441-fe89-44c0-99a9-813538f9bba1",
                  "cellValue": "costTab",
                  "linkTarget": "parameter",
                  "linkLabel": "AKS",
                  "subTarget": "aks",
                  "style": "link"
                },
                {
                  "id": "6a32d117-5d3c-447d-bbf4-6a6ed854cc4e",
                  "cellValue": "costTab",
                  "linkTarget": "parameter",
                  "linkLabel": "General Insights",
                  "subTarget": "insights",
                  "style": "link"
                },
                {
                  "id": "9b7a488a-3211-47f8-87b5-b8620fc3380f",
                  "cellValue": "costTab",
                  "linkTarget": "parameter",
                  "linkLabel": "App Services",
                  "subTarget": "appServices",
                  "style": "link"
                },
                {
                  "id": "016a4b58-c2b8-4f1e-bad4-bdb5312d6bae",
                  "cellValue": "costTab",
                  "linkTarget": "parameter",
                  "linkLabel": "Recovery Services",
                  "subTarget": "recovery",
                  "style": "link"
                },
                {
                  "id": "1bc0ed55-cc19-4809-b22c-54bccc0f476b",
                  "cellValue": "costTab",
                  "linkTarget": "parameter",
                  "linkLabel": "Virtual Machines",
                  "subTarget": "virtualMachines",
                  "style": "link"
                }
              ]
            },
            "name": "links - 4"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "![vm-icon](https://finopsworkbookcontent.blob.core.windows.net/finops-workbook/vm-small.png)\r\n\r\n# Virtual Machines\r\n\r\nVirtual Machines are common foundational building blocks for the Cloud.\r\n\r\n- **[ARM processors](https://azure.microsoft.com/en-us/blog/now-in-preview-azure-virtual-machines-with-ampere-altra-armbased-processors/)**: A new CPU architecture is available in Azure which could be leveraged to save up to `50%`. \r\n- **[Spot Instances](https://azure.microsoft.com/en-us/products/virtual-machines/spot/)**: Use Spot Virtual Machines to leverage unused compute capacity in Azure for a significant cost savings.\r\n- **[Stop/Start Virtual Machines](https://learn.microsoft.com/en-us/azure/automation/automation-solution-vm-management)**: Consider stopping and starting virtual machines over night / weekeneds.\r\n- **[Rightsize](https://azure.microsoft.com/en-in/blog/resize-virtual-machines/#:~:text=Resize%20virtual%20machines%201%20The%20region%20in%20which,The%20deployment%20model%20used%20for%20the%20VM.%20)**: Review the CPU and Memory utilisation for Virtual Machines in your environment to see if they can be downsized. \r\n- **[Autoscaling](https://learn.microsoft.com/en-us/azure/virtual-machine-scale-sets/virtual-machine-scale-sets-autoscale-overview)**: Review using Virtual Machine Scale Sets and configuring autoscaling to horizontally scale.\r\n- **[Reservations](https://learn.microsoft.com/en-us/azure/cost-management-billing/reservations/save-compute-costs-reservations)**: If you have consistent resource usage that supports reservations, buying a reservation gives you the option to reduce your costs.\r\n- **[Savings Plans](https://learn.microsoft.com/en-us/azure/cost-management-billing/savings-plan/savings-plan-compute-overview)**: An Azure savings plan helps you save money by allowing you to commit to a fixed hourly spend on compute services for one-year or three-year terms.\r\n- **[New VM SKUs / Sizes](https://learn.microsoft.com/en-us/azure/virtual-machines/sizes)**: Look at leveraging new Virtual Machine types and sizes. Upgrading to a newer SKU could reduce the cost and provide improvements.\r\n\r\n> **Note: This page is a work in progress**"
                  },
                  "name": "text - 0"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "resources \r\n| where type =~ 'microsoft.compute/virtualmachines' and tostring(properties.extended.instanceView.powerState.displayStatus) != 'VM deallocated' and tostring(properties.extended.instanceView.powerState.displayStatus) != 'VM running'\r\n| extend  VMname=name, PowerState=tostring(properties.extended.instanceView.powerState.displayStatus), VMLocation=location, VMID=id\r\n| order by VMID asc\r\n| project VMID,VMname, PowerState, VMLocation, resourceGroup, subscriptionId",
                    "size": 0,
                    "title": "Virtual Machines in a Stopped State",
                    "noDataMessage": "You have no VMs in a stopped state",
                    "noDataMessageStyle": 3,
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Subscription}"
                    ]
                  },
                  "name": "query - 3"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "costTab",
              "comparison": "isEqualTo",
              "value": "virtualMachines"
            },
            "name": "virtualMachineGroup"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "![recovery-icon](https://finopsworkbookcontent.blob.core.windows.net/finops-workbook/Recovery-Services-Vaults-small.png)\r\n\r\n# Recovery Services\r\n\r\nYou can use the Azure Backup service to back up data to the Microsoft Azure cloud platform.\r\n\r\n- **[Data Redundancy](https://learn.microsoft.com/en-us/azure/backup/backup-architecture#where-is-data-backed-up)**: The data can be stored Geographically (GRS: 6 copies in two regions) or locally (LRS: 3 copies in 1 region)\r\n- **[Backup Policies](https://learn.microsoft.com/en-us/azure/backup/backup-architecture#backup-policy-essentials)**: Check the data retention set in the policies.\r\n- **Backup Storage Consumed**: Check the size of each recovery services vault for anomalies or where the data redundancy could be toggled. "
                  },
                  "name": "text - 0"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "## Recovery Services Vault - Replications\r\n\r\nThe vaults listed in the list show any Backup Policies for an Azure Data Source and the retention set for this policy. \r\n\r\n- Investigate the data retention for each policy (ensure data isn't kept longer than it needs to be, especially if it can be recreated). \r\n- Check the replication type to ensure the appropriate amount of copies are retained. \r\n\r\n> **Select on of the vaults to see more information below. **",
                    "style": "info"
                  },
                  "customWidth": "20",
                  "name": "text - 3"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "ResourceContainers \r\n| where type =~ 'Microsoft.Resources/subscriptions' \r\n| extend SubscriptionName=name \r\n| join ( Resources | where type == 'microsoft.recoveryservices/vaults' | extend recoveryvault=id, skuTier=tostring(sku['tier']),skuName=tostring(sku['name']) , RecoveryVaultName=name, RecoveryVaultLocation=location, RVRG=resourceGroup) on subscriptionId \r\n| join ( \r\nRecoveryServicesResources\r\n| where type in (\"microsoft.recoveryservices/vaults/replicationjobs\", \"microsoft.recoveryservices/vaults/backuppolicies\")\r\n| extend recoveryvault = trim_end( @\"\\/(backupPolicies|replicationJobs).*\", id)\r\n| summarize ReplicationJobs = countif(type == \"microsoft.recoveryservices/vaults/replicationjobs\"), BackupJobs = countif(type == \"microsoft.recoveryservices/vaults/backuppolicies\") by recoveryvault\r\n) on recoveryvault\r\n| project recoveryvault, RVRG, subscriptionId, RecoveryVaultName, ReplicationJobs, BackupJobs\r\n| order by BackupJobs",
                    "size": 2,
                    "title": "Recovery Vaults Replication ",
                    "exportedParameters": [
                      {
                        "fieldName": "RVRG",
                        "parameterName": "resourceGroupVault",
                        "parameterType": 1
                      },
                      {
                        "fieldName": "SubscriptionName",
                        "parameterName": "subscriptionName",
                        "parameterType": 1
                      },
                      {
                        "fieldName": "subscriptionId",
                        "parameterName": "subscriptionId",
                        "parameterType": 1
                      },
                      {
                        "fieldName": "RecoveryVaultName",
                        "parameterName": "vaultName",
                        "parameterType": 1
                      }
                    ],
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Subscription}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "recoveryvault",
                          "formatter": 13,
                          "formatOptions": {
                            "linkTarget": null,
                            "showIcon": true
                          }
                        },
                        {
                          "columnMatch": "subscriptionId",
                          "formatter": 15,
                          "formatOptions": {
                            "linkTarget": null,
                            "showIcon": true
                          }
                        },
                        {
                          "columnMatch": "RecoveryVaultName",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "SubscriptionName",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "recoveryvault1",
                          "formatter": 13,
                          "formatOptions": {
                            "linkTarget": null,
                            "showIcon": true
                          }
                        }
                      ]
                    },
                    "sortBy": []
                  },
                  "customWidth": "80",
                  "name": "query - 1 - Copy"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupVault}/providers/Microsoft.RecoveryServices/vaults/{vaultName}/usages?\",\"urlParams\":[{\"key\":\"api-version\",\"value\":\"2022-09-30-preview\"}],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.value[?(@.name.value == \\\"GRSStorageUsage\\\")]\",\"columns\":[{\"path\":\"$.currentValue\",\"columnid\":\"GRSStorage\"}]}}]}",
                    "size": 4,
                    "title": "GRS Storage Usage",
                    "queryType": 12,
                    "visualization": "tiles",
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "GRSStorage",
                        "numberFormat": {
                          "unit": 2,
                          "options": {
                            "style": "decimal"
                          }
                        }
                      },
                      "showBorder": false
                    }
                  },
                  "customWidth": "20",
                  "name": "query - 2 - Copy"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupVault}/providers/Microsoft.RecoveryServices/vaults/{vaultName}/usages?\",\"urlParams\":[{\"key\":\"api-version\",\"value\":\"2022-09-30-preview\"}],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.value[?(@.name.value == \\\"LRSStorageUsage\\\")]\",\"columns\":[{\"path\":\"$.currentValue\",\"columnid\":\"GRSStorage\"}]}}]}",
                    "size": 4,
                    "title": "LRS Storage Usage",
                    "queryType": 12,
                    "visualization": "tiles",
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "GRSStorage",
                        "numberFormat": {
                          "unit": 2,
                          "options": {
                            "style": "decimal"
                          }
                        }
                      },
                      "showBorder": false
                    }
                  },
                  "customWidth": "20",
                  "name": "query - 2 - Copy - Copy"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupVault}/providers/Microsoft.RecoveryServices/vaults/{vaultName}/usages?\",\"urlParams\":[{\"key\":\"api-version\",\"value\":\"2022-09-30-preview\"}],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.value[?(@.name.value == \\\"RAGRSStorageUsage\\\")]\",\"columns\":[{\"path\":\"$.currentValue\",\"columnid\":\"GRSStorage\"}]}}]}",
                    "size": 4,
                    "title": "RAGRS Storage Usage",
                    "queryType": 12,
                    "visualization": "tiles",
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "GRSStorage",
                        "numberFormat": {
                          "unit": 2,
                          "options": {
                            "style": "decimal"
                          }
                        }
                      },
                      "showBorder": false
                    }
                  },
                  "customWidth": "20",
                  "name": "query - 2 - Copy - Copy - Copy"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupVault}/providers/Microsoft.RecoveryServices/vaults/{vaultName}/usages?\",\"urlParams\":[{\"key\":\"api-version\",\"value\":\"2022-09-30-preview\"}],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.value[?(@.name.value == \\\"ArchiveGRSStorageUsage\\\")]\",\"columns\":[{\"path\":\"$.currentValue\",\"columnid\":\"GRSStorage\"}]}}]}",
                    "size": 4,
                    "title": "Archive GRS Storage Usage",
                    "queryType": 12,
                    "visualization": "tiles",
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "GRSStorage",
                        "numberFormat": {
                          "unit": 2,
                          "options": {
                            "style": "decimal"
                          }
                        }
                      },
                      "showBorder": false
                    }
                  },
                  "customWidth": "20",
                  "name": "query - 2 - Copy - Copy - Copy - Copy"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupVault}/providers/Microsoft.RecoveryServices/vaults/{vaultName}/usages?\",\"urlParams\":[{\"key\":\"api-version\",\"value\":\"2022-09-30-preview\"}],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.value[?(@.name.value == \\\"ArchiveLRSStorageUsage\\\")]\",\"columns\":[{\"path\":\"$.currentValue\",\"columnid\":\"GRSStorage\"}]}}]}",
                    "size": 4,
                    "title": "Archive LRS Storage Usage",
                    "queryType": 12,
                    "visualization": "tiles",
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "GRSStorage",
                        "numberFormat": {
                          "unit": 2,
                          "options": {
                            "style": "decimal"
                          }
                        }
                      },
                      "showBorder": false
                    }
                  },
                  "customWidth": "20",
                  "name": "query - 2 - Copy - Copy - Copy - Copy - Copy"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "costTab",
              "comparison": "isEqualTo",
              "value": "recovery"
            },
            "name": "recoveryGroup"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "![app-service-icon](https://finopsworkbookcontent.blob.core.windows.net/finops-workbook/App-Service-Plans-small.png)\r\n\r\n# Azure App Services & Plans\r\n\r\n- **[App Service Environments v3 (ASEv3)](https://learn.microsoft.com/en-us/azure/cost-management-billing/reservations/reservation-discount-app-service)**: Evaluate using ASEv3s as they allow for reservation to be purchased and can be cheaper to run.\r\n- **[Autoscaling](https://learn.microsoft.com/en-us/azure/azure-monitor/autoscale/autoscale-get-started?toc=%2Fazure%2Fapp-service%2Ftoc.json)**: Ensure App Services are using AutoScaling to horizontally scale based on load.\r\n- **[Plan Utilisation](https://learn.microsoft.com/en-us/azure/app-service/monitor-app-service)**: Check if plans are being fully utilised. Plans that are running a `Premium` or `Isolated` SKU can run multiple App Services, so it may be worth reviewing consolidating the apps onto a single plan (consider migrating to asev3).\r\n- **Status**: Check if there's any `Stopped` apps. \r\n- **[Stampfees](https://azure.microsoft.com/en-us/pricing/details/app-service/windows)**: Isolated SKU App Service Plans incur a `Stamp fee` for each environment.\r\n- **[Elastic Function App SKUs](https://learn.microsoft.com/en-us/azure/azure-functions/functions-premium-plan?tabs=portal)**: Consider using an Elastic SKU rather than a static SKU. "
                  },
                  "name": "text - 0"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "resources\r\n| where type =~ 'Microsoft.Web/sites'\r\n| extend WebAppId=id, WebAppRG=resourceGroup, WebAppName=name, AppServicePlan=tostring(properties.serverFarmId), SKU=tostring(properties.sku), Type=kind, Status=tostring(properties.state), WebAppLocation=location, SubscriptionName=subscriptionId\r\n| project WebAppId,WebAppName, Type, Status, WebAppLocation, AppServicePlan, WebAppRG,SubscriptionName\r\n| order by WebAppId asc",
                    "size": 0,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Subscription}"
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "isVisible",
                    "comparison": "isEqualTo",
                    "value": "Never"
                  },
                  "name": "query - WebFunctionStatus"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "resources\r\n| where type == \"microsoft.web/serverfarms\"\r\n| extend  planId=tolower(tostring(id)),skuname = tostring(sku.name) , skutier = tostring(sku.tier), workers=tostring(properties.numberOfWorkers),webRG=resourceGroup,maxworkers=tostring(properties.maximumNumberOfWorkers), SubscriptionName=subscriptionId\r\n| project planId, name, skuname, skutier, workers, maxworkers, webRG, SubscriptionName\r\n| join kind=leftouter (resources | where type ==\"microsoft.insights/autoscalesettings\" | project planId=tolower(tostring(properties.targetResourceUri)), PredictiveAutoscale=properties.predictiveAutoscalePolicy.scaleMode, AutoScaleProfiles=properties.profiles,resourceGroup) on planId",
                    "size": 0,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Subscription}"
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "isVisible",
                    "comparison": "isEqualTo",
                    "value": "Never"
                  },
                  "name": "query - AppServiceplandetails"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "resources\r\n| where type == \"microsoft.web/serverfarms\"\r\n| extend  planId=tolower(tostring(id)),skuname = tostring(sku.name) , skutier = tostring(sku.tier), workers=tostring(properties.numberOfWorkers),webRG=resourceGroup,maxworkers=tostring(properties.maximumNumberOfWorkers), SubscriptionName=subscriptionId\r\n\r\n| where skutier !in('Basic','Free','Shared')\r\n| project planId, name, skuname, skutier, workers, maxworkers, webRG, SubscriptionName\r\n| join kind=leftouter (resources | where type ==\"microsoft.insights/autoscalesettings\" | project planId=tolower(tostring(properties.targetResourceUri)), PredictiveAutoscale=properties.predictiveAutoscalePolicy.scaleMode, AutoScaleProfiles=properties.profiles,resourceGroup) on planId\r\n| summarize ['Disabled'] = countif(isempty(AutoScaleProfiles))",
                    "size": 4,
                    "title": "Apps Without Autoscaling",
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Subscription}"
                    ],
                    "visualization": "tiles",
                    "tileSettings": {
                      "titleContent": {},
                      "leftContent": {
                        "columnMatch": "Disabled",
                        "formatter": 12,
                        "formatOptions": {
                          "max": 0,
                          "palette": "red"
                        }
                      },
                      "showBorder": false
                    }
                  },
                  "customWidth": "30",
                  "name": "query - AppServiceplandetails - Copy"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "resources\r\n| where type == \"microsoft.web/serverfarms\"\r\n| extend  planId=tolower(tostring(id)),skuname = tostring(sku.name) , skutier = tostring(sku.tier), workers=tostring(properties.numberOfWorkers),webRG=resourceGroup,maxworkers=tostring(properties.maximumNumberOfWorkers), SubscriptionName=subscriptionId\r\n| project planId, name, skuname, skutier, workers, maxworkers, webRG, SubscriptionName\r\n| where skutier startswith \"Premium\" and toint(workers) <= 1\r\n| where skutier in ('Premium', 'PremiumV2', 'ElasticPremium', 'PremiumV3') and toint(workers) <= 1\r\n| summarize count()\r\n",
                    "size": 4,
                    "title": "Premium App Service Plans with 1 app",
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Subscription}"
                    ],
                    "visualization": "tiles",
                    "tileSettings": {
                      "titleContent": {},
                      "leftContent": {
                        "columnMatch": "count_",
                        "formatter": 12,
                        "formatOptions": {
                          "max": 1,
                          "palette": "red"
                        }
                      },
                      "rightContent": {
                        "columnMatch": "Enabled",
                        "formatter": 12,
                        "formatOptions": {
                          "max": 1,
                          "palette": "green"
                        }
                      },
                      "showBorder": false
                    }
                  },
                  "customWidth": "30",
                  "name": "query - AppServiceplandetails - Copy - Copy"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"3fddbdd9-c4eb-46ae-b6b0-654c0da7b1a8\",\"mergeType\":\"inner\",\"leftTable\":\"query - AppServiceplandetails\",\"rightTable\":\"query - WebFunctionStatus\",\"leftColumn\":\"planId\",\"rightColumn\":\"AppServicePlan\"}],\"projectRename\":[{\"originalName\":\"[query - WebFunctionStatus].WebAppId\",\"mergedName\":\"WebAppId\",\"fromId\":\"3fddbdd9-c4eb-46ae-b6b0-654c0da7b1a8\"},{\"originalName\":\"[query - WebFunctionStatus].Type\",\"mergedName\":\"Type\",\"fromId\":\"3fddbdd9-c4eb-46ae-b6b0-654c0da7b1a8\"},{\"originalName\":\"[query - WebFunctionStatus].WebAppLocation\",\"mergedName\":\"WebAppLocation\",\"fromId\":\"3fddbdd9-c4eb-46ae-b6b0-654c0da7b1a8\"},{\"originalName\":\"[query - WebFunctionStatus].Status\",\"mergedName\":\"Status\",\"fromId\":\"3fddbdd9-c4eb-46ae-b6b0-654c0da7b1a8\"},{\"originalName\":\"[query - AppServiceplandetails].SubscriptionName\",\"mergedName\":\"SubscriptionName\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - WebFunctionStatus].WebAppRG\",\"mergedName\":\"ResourceGroup\",\"fromId\":\"3fddbdd9-c4eb-46ae-b6b0-654c0da7b1a8\"},{\"originalName\":\"[query - AppServiceplandetails].type\",\"mergedName\":\"type\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - AppServiceplandetails].tenantId\",\"mergedName\":\"tenantId\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - AppServiceplandetails].kind\",\"mergedName\":\"kind\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - AppServiceplandetails].location\",\"mergedName\":\"location\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - AppServiceplandetails].subscriptionId\",\"mergedName\":\"subscriptionId\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - AppServiceplandetails].managedBy\",\"mergedName\":\"managedBy\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - AppServiceplandetails].sku\",\"mergedName\":\"sku\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - AppServiceplandetails].plan\",\"mergedName\":\"plan\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - AppServiceplandetails].skuname\",\"mergedName\":\"skuname\",\"fromId\":\"3fddbdd9-c4eb-46ae-b6b0-654c0da7b1a8\"},{\"originalName\":\"[query - AppServiceplandetails].skutier\",\"mergedName\":\"skutier\",\"fromId\":\"3fddbdd9-c4eb-46ae-b6b0-654c0da7b1a8\"},{\"originalName\":\"[query - AppServiceplandetails].workers\",\"mergedName\":\"workers\",\"fromId\":\"3fddbdd9-c4eb-46ae-b6b0-654c0da7b1a8\"},{\"originalName\":\"[query - AppServiceplandetails].maxworkers\",\"mergedName\":\"maxworkers\",\"fromId\":\"3fddbdd9-c4eb-46ae-b6b0-654c0da7b1a8\"},{\"originalName\":\"[query - AppServiceplandetails].properties\",\"mergedName\":\"properties\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - AppServiceplandetails].tags\",\"mergedName\":\"tags\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - AppServiceplandetails].identity\",\"mergedName\":\"identity\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - AppServiceplandetails].zones\",\"mergedName\":\"zones\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - AppServiceplandetails].extendedLocation\",\"mergedName\":\"extendedLocation\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - AppServiceplandetails].planId\",\"mergedName\":\"planId\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - AppServiceplandetails].PredictiveAutoscale\",\"mergedName\":\"PredictiveAutoscale\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - AppServiceplandetails].AutoScaleProfiles\",\"mergedName\":\"AutoScaleProfiles\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - AppServiceplandetails].resourceGroup1\",\"mergedName\":\"resourceGroup1\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - AppServiceplandetails].name\",\"mergedName\":\"name\",\"fromId\":\"3fddbdd9-c4eb-46ae-b6b0-654c0da7b1a8\"},{\"originalName\":\"[query - AppServiceplandetails].webRG\",\"mergedName\":\"webRG\",\"fromId\":\"3fddbdd9-c4eb-46ae-b6b0-654c0da7b1a8\"},{\"originalName\":\"[query - AppServiceplandetails].planId1\",\"mergedName\":\"planId1\",\"fromId\":\"3fddbdd9-c4eb-46ae-b6b0-654c0da7b1a8\"},{\"originalName\":\"[query - AppServiceplandetails].resourceGroup\",\"mergedName\":\"resourceGroup\",\"fromId\":\"3fddbdd9-c4eb-46ae-b6b0-654c0da7b1a8\"},{\"originalName\":\"[query - WebFunctionStatus].WebAppName\",\"mergedName\":\"WebAppName\",\"fromId\":\"3fddbdd9-c4eb-46ae-b6b0-654c0da7b1a8\"},{\"originalName\":\"[query - WebFunctionStatus].AppServicePlan\",\"mergedName\":\"AppServicePlan\",\"fromId\":\"3fddbdd9-c4eb-46ae-b6b0-654c0da7b1a8\"},{\"originalName\":\"[query - WebFunctionStatus].SubscriptionName\"}]}",
                    "size": 2,
                    "title": "App Services by Plan",
                    "noDataMessage": "You have no Apps!",
                    "showExportToExcel": true,
                    "queryType": 7,
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "$gen_group",
                          "formatter": 13,
                          "formatOptions": {
                            "linkTarget": null,
                            "showIcon": true
                          }
                        },
                        {
                          "columnMatch": "WebAppLocation",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "Status",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "Running",
                                "representation": "success",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Stopped",
                                "representation": "disabled",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "success",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "SubscriptionName",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "ResourceGroup",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "name",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "planId",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "webRG",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "planId1",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "resourceGroup",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "WebAppName",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "AppServicePlan",
                          "formatter": 5
                        }
                      ],
                      "filter": true,
                      "hierarchySettings": {
                        "treeType": 1,
                        "groupBy": [
                          "name"
                        ],
                        "expandTopLevel": true
                      }
                    }
                  },
                  "name": "query - 10"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "costTab",
              "comparison": "isEqualTo",
              "value": "appServices"
            },
            "name": "appServicesGroup"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "![storage-acc-logo](https://finopsworkbookcontent.blob.core.windows.net/finops-workbook/Storage-Accounts-small.png)\r\n\r\n# StorageAccounts\r\n\r\nStorage accounts are occassionally forgotten about but can cause bill shock. There's different SKUs, durability, capacity reservation and lifecycle options available that can greatly reduce the cost. \r\n\r\n- **[LifeCycle Policies](https://learn.microsoft.com/en-us/azure/storage/blobs/lifecycle-management-policy-configure?tabs=azure-portal)**: Automatically move unused blobs to lower storage tiers for cost savings (or delete them). \r\n- **[Capacity Reservations](https://learn.microsoft.com/en-us/azure/storage/blobs/storage-blob-reserved-capacity)**: `Standard` sku storage accounts are applicable for capacity reservations starting at 100TB for a `38%` discount.\r\n- **[Durability](https://learn.microsoft.com/en-us/azure/storage/common/storage-redundancy)**: Storageaccounts have various durability options. This refers to how many copies of the data are stored. Lower environments may not need 6 copies (GRS). \r\n\r\n> **The query below checks the size of each Storage Account for the specified timerange and requires time to load**\r\n"
                  },
                  "name": "text - 11"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "## Storage Account - Overview\r\n\r\n- Looks for opportunities to use lower SKUs and Tiers for lower environments (test, dev, pocs)\r\n- Use the columns to filter by the `Account used capacity`\r\n- [SKU Types](https://learn.microsoft.com/en-us/azure/storage/common/storage-account-overview)\r\n",
                    "style": "info"
                  },
                  "customWidth": "20",
                  "name": "text - 6"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "resources \r\n| where type =~ 'Microsoft.Storage/StorageAccounts' and kind == 'StorageV2' and kind !='FileStorage' and kind != \"BlockBlobStorage\"\r\n| extend storageaccount=id, StorageAccountName=name, SAKind=kind,AccessTier=tostring(properties.accessTier),SKUName=sku.name, SKUTier=sku.tier, Location=location\r\n| order by id asc\r\n| project name, storageaccount, SKUName, SKUTier, SAKind, resourceGroup, subscriptionId, AccessTier\r\n//| summarize count() by tostring(SKUName), tostring(SKUTier)",
                    "size": 1,
                    "title": "Storage Accounts by SKU and Tier",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Subscription}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "storageaccount",
                          "formatter": 13,
                          "formatOptions": {
                            "linkTarget": "Resource",
                            "subTarget": "insights",
                            "linkIsContextBlade": true,
                            "showIcon": true
                          }
                        },
                        {
                          "columnMatch": "subscriptionId",
                          "formatter": 15,
                          "formatOptions": {
                            "linkTarget": null,
                            "showIcon": true
                          }
                        }
                      ]
                    }
                  },
                  "customWidth": "30",
                  "conditionalVisibility": {
                    "parameterName": "display",
                    "comparison": "isEqualTo",
                    "value": "never"
                  },
                  "name": "storageaccountgen2"
                },
                {
                  "type": 10,
                  "content": {
                    "chartId": "workbookdb19a8d8-91af-44ea-951d-5ffa133b2ebe",
                    "version": "MetricsItem/2.0",
                    "size": 0,
                    "chartType": 0,
                    "resourceType": "microsoft.storage/storageaccounts",
                    "metricScope": 0,
                    "resourceParameter": "StorageAccounts",
                    "resourceIds": [
                      "{StorageAccounts}"
                    ],
                    "timeContextFromParameter": "TimeRange",
                    "timeContext": {
                      "durationMs": 14400000
                    },
                    "metrics": [
                      {
                        "namespace": "microsoft.storage/storageaccounts",
                        "metric": "microsoft.storage/storageaccounts-Capacity-UsedCapacity",
                        "aggregation": 4
                      },
                      {
                        "namespace": "microsoft.storage/storageaccounts/blobservices",
                        "metric": "microsoft.storage/storageaccounts/blobservices-Capacity-BlobCapacity",
                        "aggregation": 4
                      },
                      {
                        "namespace": "microsoft.storage/storageaccounts/fileservices",
                        "metric": "microsoft.storage/storageaccounts/fileservices-Capacity-FileCapacity",
                        "aggregation": 4
                      },
                      {
                        "namespace": "microsoft.storage/storageaccounts/queueservices",
                        "metric": "microsoft.storage/storageaccounts/queueservices-Capacity-QueueCapacity",
                        "aggregation": 4
                      },
                      {
                        "namespace": "microsoft.storage/storageaccounts/tableservices",
                        "metric": "microsoft.storage/storageaccounts/tableservices-Capacity-TableCapacity",
                        "aggregation": 4
                      }
                    ],
                    "title": "StorageAccounts by Capacity",
                    "resourceLimit": 2000,
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Subscription",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "microsoft.storage/storageaccounts-Capacity-UsedCapacity$|microsoft.storage/storageaccounts/blobservices-Capacity-BlobCapacity$|microsoft.storage/storageaccounts/fileservices-Capacity-FileCapacity$|microsoft.storage/storageaccounts/queueservices-Capacity-QueueCapacity$|microsoft.storage/storageaccounts/tableservices-Capacity-TableCapacity$",
                          "formatter": 8,
                          "formatOptions": {
                            "min": 0,
                            "palette": "blue",
                            "linkTarget": "WorkbookTemplate",
                            "workbookContext": {
                              "componentIdSource": "column",
                              "componentId": "Name",
                              "resourceIdsSource": "column",
                              "resourceIds": "Name",
                              "templateIdSource": "static",
                              "templateId": "Community-Workbooks/Individual Storage/Capacity",
                              "typeSource": "static",
                              "type": "workbook",
                              "gallerySource": "static",
                              "gallery": "microsoft.storage/storageaccounts"
                            }
                          },
                          "numberFormat": {
                            "unit": 2,
                            "options": {
                              "style": "decimal",
                              "maximumFractionDigits": 1
                            }
                          }
                        },
                        {
                          "columnMatch": "microsoft.storage/storageaccounts-Capacity-UsedCapacity Timeline$|Account used capacity Timeline$",
                          "formatter": 21,
                          "formatOptions": {
                            "min": 0,
                            "palette": "blue"
                          }
                        },
                        {
                          "columnMatch": "microsoft.storage/storageaccounts/blobservices-Capacity-BlobCapacity Timeline$|Blob capacity Timeline$",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "microsoft.storage/storageaccounts/fileservices-Capacity-FileCapacity Timeline$|File capacity Timeline$",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "microsoft.storage/storageaccounts/queueservices-Capacity-QueueCapacity Timeline$|Queue capacity Timeline$",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "microsoft.storage/storageaccounts/tableservices-Capacity-TableCapacity Timeline$|Table capacity Timeline$",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "Name",
                          "formatter": 13,
                          "formatOptions": {
                            "linkTarget": "Resource"
                          }
                        }
                      ],
                      "rowLimit": 10000,
                      "filter": true,
                      "labelSettings": [
                        {
                          "columnId": "Subscription",
                          "label": "Subscription"
                        },
                        {
                          "columnId": "microsoft.storage/storageaccounts-Capacity-UsedCapacity",
                          "label": "Account used capacity"
                        },
                        {
                          "columnId": "microsoft.storage/storageaccounts-Capacity-UsedCapacity Timeline",
                          "label": "Account used capacity timeline"
                        },
                        {
                          "columnId": "microsoft.storage/storageaccounts/blobservices-Capacity-BlobCapacity",
                          "label": "Blob capacity"
                        },
                        {
                          "columnId": "microsoft.storage/storageaccounts/blobservices-Capacity-BlobCapacity Timeline",
                          "label": "Blob capacity Timeline"
                        },
                        {
                          "columnId": "microsoft.storage/storageaccounts/fileservices-Capacity-FileCapacity",
                          "label": "File capacity"
                        },
                        {
                          "columnId": "microsoft.storage/storageaccounts/fileservices-Capacity-FileCapacity Timeline",
                          "label": "File capacity Timeline"
                        },
                        {
                          "columnId": "microsoft.storage/storageaccounts/queueservices-Capacity-QueueCapacity",
                          "label": "Queue capacity"
                        },
                        {
                          "columnId": "microsoft.storage/storageaccounts/queueservices-Capacity-QueueCapacity Timeline",
                          "label": "Queue capacity Timeline"
                        },
                        {
                          "columnId": "microsoft.storage/storageaccounts/tableservices-Capacity-TableCapacity",
                          "label": "Table capacity"
                        },
                        {
                          "columnId": "microsoft.storage/storageaccounts/tableservices-Capacity-TableCapacity Timeline",
                          "label": "Table capacity Timeline"
                        }
                      ]
                    },
                    "sortBy": [],
                    "showExportToExcel": true
                  },
                  "customWidth": "80",
                  "conditionalVisibility": {
                    "parameterName": "visible",
                    "comparison": "isEqualTo",
                    "value": "never"
                  },
                  "showPin": false,
                  "name": "storage account capacity metrics",
                  "styleSettings": {
                    "margin": "0 10px 0 10px"
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"27c02d95-67bf-4cf1-b011-2a497e75aaee\",\"mergeType\":\"leftouter\",\"leftTable\":\"storageaccountgen2\",\"rightTable\":\"storage account capacity metrics\",\"leftColumn\":\"storageaccount\",\"rightColumn\":\"Name\"}],\"projectRename\":[{\"originalName\":\"Name\",\"mergedName\":\"Name\",\"fromId\":\"unknown\"},{\"originalName\":\"Subscription\",\"mergedName\":\"Subscription\",\"fromId\":\"unknown\"},{\"originalName\":\"microsoft.storage/storageaccounts-Capacity-UsedCapacity\",\"mergedName\":\"microsoft.storage/storageaccounts-Capacity-UsedCapacity\",\"fromId\":\"unknown\"},{\"originalName\":\"microsoft.storage/storageaccounts/blobservices-Capacity-BlobCapacity\",\"mergedName\":\"microsoft.storage/storageaccounts/blobservices-Capacity-BlobCapacity\",\"fromId\":\"unknown\"},{\"originalName\":\"microsoft.storage/storageaccounts/fileservices-Capacity-FileCapacity\",\"mergedName\":\"microsoft.storage/storageaccounts/fileservices-Capacity-FileCapacity\",\"fromId\":\"unknown\"},{\"originalName\":\"microsoft.storage/storageaccounts/queueservices-Capacity-QueueCapacity\",\"mergedName\":\"microsoft.storage/storageaccounts/queueservices-Capacity-QueueCapacity\",\"fromId\":\"unknown\"},{\"originalName\":\"microsoft.storage/storageaccounts/tableservices-Capacity-TableCapacity\",\"mergedName\":\"microsoft.storage/storageaccounts/tableservices-Capacity-TableCapacity\",\"fromId\":\"unknown\"},{\"originalName\":\"[storageaccountgen2].name\",\"mergedName\":\"name\",\"fromId\":\"27c02d95-67bf-4cf1-b011-2a497e75aaee\"},{\"originalName\":\"[storageaccountgen2].storageaccount\",\"mergedName\":\"storageaccount\",\"fromId\":\"27c02d95-67bf-4cf1-b011-2a497e75aaee\"},{\"originalName\":\"[storageaccountgen2].SKUName\",\"mergedName\":\"SKUName\",\"fromId\":\"27c02d95-67bf-4cf1-b011-2a497e75aaee\"},{\"originalName\":\"[storageaccountgen2].SKUTier\",\"mergedName\":\"SKUTier\",\"fromId\":\"27c02d95-67bf-4cf1-b011-2a497e75aaee\"},{\"originalName\":\"[storageaccountgen2].SAKind\",\"mergedName\":\"SAKind\",\"fromId\":\"27c02d95-67bf-4cf1-b011-2a497e75aaee\"},{\"originalName\":\"[storageaccountgen2].resourceGroup\",\"mergedName\":\"resourceGroup\",\"fromId\":\"27c02d95-67bf-4cf1-b011-2a497e75aaee\"},{\"originalName\":\"[storageaccountgen2].subscriptionId\",\"mergedName\":\"subscriptionId\",\"fromId\":\"27c02d95-67bf-4cf1-b011-2a497e75aaee\"},{\"originalName\":\"[storageaccountgen2].AccessTier\",\"mergedName\":\"AccessTier\",\"fromId\":\"27c02d95-67bf-4cf1-b011-2a497e75aaee\"},{\"originalName\":\"[storage account capacity metrics].Subscription\",\"mergedName\":\"Subscription1\",\"fromId\":\"27c02d95-67bf-4cf1-b011-2a497e75aaee\"},{\"originalName\":\"[storage account capacity metrics].Name\",\"mergedName\":\"Name1\",\"fromId\":\"27c02d95-67bf-4cf1-b011-2a497e75aaee\"},{\"originalName\":\"[storage account capacity metrics].microsoft.storage/storageaccounts-Capacity-UsedCapacity\",\"mergedName\":\"Account used capacity\",\"fromId\":\"27c02d95-67bf-4cf1-b011-2a497e75aaee\"},{\"originalName\":\"[storage account capacity metrics].microsoft.storage/storageaccounts/blobservices-Capacity-BlobCapacity\",\"mergedName\":\"Blob capacity\",\"fromId\":\"27c02d95-67bf-4cf1-b011-2a497e75aaee\"},{\"originalName\":\"[storage account capacity metrics].microsoft.storage/storageaccounts/fileservices-Capacity-FileCapacity\",\"mergedName\":\"File capacity\",\"fromId\":\"27c02d95-67bf-4cf1-b011-2a497e75aaee\"},{\"originalName\":\"[storage account capacity metrics].microsoft.storage/storageaccounts/queueservices-Capacity-QueueCapacity\",\"mergedName\":\"Queue capacity\",\"fromId\":\"27c02d95-67bf-4cf1-b011-2a497e75aaee\"},{\"originalName\":\"[storage account capacity metrics].microsoft.storage/storageaccounts/tableservices-Capacity-TableCapacity\",\"mergedName\":\"Table capacity\",\"fromId\":\"27c02d95-67bf-4cf1-b011-2a497e75aaee\"},{\"originalName\":\"microsoft.storage/storageaccounts-Capacity-UsedCapacity Timeline\"},{\"originalName\":\"microsoft.storage/storageaccounts/blobservices-Capacity-BlobCapacity Timeline\"},{\"originalName\":\"microsoft.storage/storageaccounts/fileservices-Capacity-FileCapacity Timeline\"},{\"originalName\":\"microsoft.storage/storageaccounts/queueservices-Capacity-QueueCapacity Timeline\"},{\"originalName\":\"microsoft.storage/storageaccounts/tableservices-Capacity-TableCapacity Timeline\"},{\"originalName\":\"[storage account capacity metrics].microsoft.storage/storageaccounts-Capacity-UsedCapacity Timeline\"},{\"originalName\":\"[storage account capacity metrics].microsoft.storage/storageaccounts/blobservices-Capacity-BlobCapacity Timeline\"},{\"originalName\":\"[storage account capacity metrics].microsoft.storage/storageaccounts/fileservices-Capacity-FileCapacity Timeline\"},{\"originalName\":\"[storage account capacity metrics].microsoft.storage/storageaccounts/queueservices-Capacity-QueueCapacity Timeline\"},{\"originalName\":\"[storage account capacity metrics].microsoft.storage/storageaccounts/tableservices-Capacity-TableCapacity Timeline\"}]}",
                    "size": 0,
                    "title": "Storage Account Overview",
                    "showExportToExcel": true,
                    "queryType": 7,
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "name",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "SAKind",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "resourceGroup",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "subscriptionId",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "Subscription1",
                          "formatter": 15,
                          "formatOptions": {
                            "linkTarget": "Resource",
                            "showIcon": false
                          }
                        },
                        {
                          "columnMatch": "Name1",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "Account used capacity",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 2,
                            "options": {
                              "style": "decimal"
                            }
                          }
                        },
                        {
                          "columnMatch": "Blob capacity",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 2,
                            "options": {
                              "style": "decimal"
                            }
                          }
                        },
                        {
                          "columnMatch": "File capacity",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 2,
                            "options": {
                              "style": "decimal"
                            }
                          }
                        },
                        {
                          "columnMatch": "Queue capacity",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 2,
                            "options": {
                              "style": "decimal"
                            }
                          }
                        },
                        {
                          "columnMatch": "Table capacity",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 2,
                            "options": {
                              "style": "decimal"
                            }
                          }
                        }
                      ],
                      "rowLimit": 1000,
                      "filter": true,
                      "sortBy": [
                        {
                          "itemKey": "$gen_number_Account used capacity_10",
                          "sortOrder": 2
                        }
                      ],
                      "labelSettings": [
                        {
                          "columnId": "storageaccount",
                          "label": "Storage Account"
                        },
                        {
                          "columnId": "Subscription1",
                          "label": "Subscription"
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "$gen_number_Account used capacity_10",
                        "sortOrder": 2
                      }
                    ]
                  },
                  "customWidth": "80",
                  "showPin": false,
                  "name": "query - 9"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "## Storage Account V1 (older) vs V2\r\n\r\nThere are two generations for Storage Accounts. It's recommended for most use cases to upgrade to General-Purpose v2 accounts as they provide:\r\n\r\n1. The lowest per-gigabyte capacity prices for Azure Storage, as well as industry-competitive transaction prices.\r\n2. Support default account access tiers of hot or cool and blob level tiering between hot, cool, or archive.\r\n3. Allows you to also use lifecycle management to optimize your storage cost",
                    "style": "info"
                  },
                  "customWidth": "20",
                  "name": "text - 5"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "resources \r\n| where type =~ 'Microsoft.Storage/StorageAccounts' and kind !='StorageV2' and kind !='FileStorage' and kind != \"BlockBlobStorage\"\r\n| extend storageaccount=id, StorageAccountName=name, SAKind=kind,AccessTier=tostring(properties.accessTier),SKUName=sku.name, SKUTier=sku.tier, Location=location\r\n| order by id asc\r\n| project storageaccount, SKUName, SKUTier, SAKind, resourceGroup, subscriptionId\r\n",
                    "size": 0,
                    "title": "V1 Storage Accounts",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Subscription}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "storageaccount",
                          "formatter": 13,
                          "formatOptions": {
                            "linkTarget": "Resource",
                            "subTarget": "insights",
                            "linkIsContextBlade": true,
                            "showIcon": true
                          }
                        },
                        {
                          "columnMatch": "subscriptionId",
                          "formatter": 15,
                          "formatOptions": {
                            "linkTarget": null,
                            "showIcon": true
                          }
                        }
                      ]
                    }
                  },
                  "customWidth": "80",
                  "name": "query - 1"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "costTab",
              "comparison": "isEqualTo",
              "value": "storageAccounts"
            },
            "name": "storageAccountGroup"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "![law-icon](https://finopsworkbookcontent.blob.core.windows.net/finops-workbook/Log-Analytics-Workspaces-small.png)\r\n\r\n# Log Analytics Workspaces\r\n\r\nLog Analytics workspaces are where logs can be stored and queried within Azure. A few services (sentinel, app insights, etc) use it as the backing data store. \r\n\r\nWhile evaluating the cost for these services review the:\r\n\r\n- **[Retention](https://learn.microsoft.com/en-us/azure/azure-monitor/logs/basic-logs-configure?tabs=portal-1%2Cportal-2#set-a-tables-log-data-plan)**: Evaluate if the retention period is required, as any data stored above the default ingestion time, has additional costs. Tables can be configured with custom retention periods (useful for metrics or logs that don't have retention requirements). \r\n- **[Basic Logs](https://learn.microsoft.com/en-us/azure/azure-monitor/logs/basic-logs-configure?tabs=portal-1%2Cportal-2#when-should-i-use-basic-logs)**: A type of Log Analytics storage that provides reduced cost for logs in a table and reduced query capabilities. \r\n- **[Insights](https://learn.microsoft.com/en-us/azure/azure-monitor/logs/log-analytics-workspace-insights-overview)**: The Insights tab of each of the Log Analytics workspaces can be used to deep dive into the usage and cost of the workspace.\r\n- **[Commitment Tiers](https://learn.microsoft.com/en-US/azure/azure-monitor/logs/cost-logs#commitment-tiers)**: Workspaces can be configured with a commitment tier (e.g. 100gb per day), these are similar to reservations and provide a discounted (up to 30%) price for log ingestion.\r\n\r\n> **The query below checks the size of each Log Analytics workspace for the specified timerange and requires time to load**"
                  },
                  "name": "text - 7"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "## Usage\r\n\r\nThe usage data shows how much data is stored in each Log Analytics Workspace. Depending upon the data that is ingested daily, the workspace may need a `commitment tier` enabled or upgraded. \r\n\r\nBefore enabling a commitment tier, it's worth evaluating the data that is being published to the Log Analytics workspace (LAW).\r\n\r\n- [Commitment Tiers](https://learn.microsoft.com/en-US/azure/azure-monitor/logs/cost-logs#commitment-tiers)\r\n\r\n- **Retention Days**: Does the data need to be stored for the specified retention? <br>- Can some tables have custom retention days?\r\n- **License**: This is the commitment tier for the workspace. Different licenses have different costs, read the article above for more information. \r\n- **Daily Cap**: Workspaces can have a `cap of data ingested` for a 24hour period. Once this limit is hit, it drops data. This is good to prevent billshock of an accidental over ingestion from an application crash. \r\n\r\n> **Select one of the workspaces to bring up the table usage details.** ",
                    "style": "info"
                  },
                  "customWidth": "20",
                  "name": "text - 4"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "Usage\r\n| project TimeGenerated, Quantity, ResourceUri\r\n| summarize IngestionVolume=sum(Quantity) by ResourceUri\r\n| order by IngestionVolume",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "Log Analytics Workspace - Usage",
                    "noDataMessage": "Select a table from the above list",
                    "timeContextFromParameter": "TimeRange",
                    "exportFieldName": "ResourceUri",
                    "exportParameterName": "ResourceUri",
                    "exportDefaultValue": "",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{LogAnalyticsWorkspace}"
                    ],
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "ResourceUri",
                          "formatter": 13,
                          "formatOptions": {
                            "linkTarget": null,
                            "showIcon": true
                          }
                        },
                        {
                          "columnMatch": "DataType",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "25ch"
                          }
                        },
                        {
                          "columnMatch": "Volume",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "green",
                            "customColumnWidthSetting": "25ch"
                          },
                          "numberFormat": {
                            "unit": 38,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumFractionDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "Solution",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "IngestionPercent",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "turquoise",
                            "customColumnWidthSetting": "25ch"
                          },
                          "numberFormat": {
                            "unit": 17,
                            "options": {
                              "style": "percent",
                              "useGrouping": false,
                              "maximumFractionDigits": 1
                            }
                          }
                        },
                        {
                          "columnMatch": "Billable",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "true",
                                "representation": "Blank",
                                "text": "Billable"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "false",
                                "representation": "Blank",
                                "text": "Not billable"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Blank",
                                "text": "{0}{1}"
                              }
                            ],
                            "compositeBarSettings": {
                              "labelText": "",
                              "columnSettings": []
                            }
                          }
                        },
                        {
                          "columnMatch": "TimeSinceLastUpdate",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "<=",
                                "thresholdValue": "5400",
                                "representation": "Blank",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "<=",
                                "thresholdValue": "10800",
                                "representation": "Blank",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": ">",
                                "thresholdValue": "10800",
                                "representation": "Normal",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Blank",
                                "text": "{0}{1}"
                              }
                            ]
                          },
                          "numberFormat": {
                            "unit": 24,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumFractionDigits": 0
                            }
                          }
                        }
                      ],
                      "rowLimit": 500
                    },
                    "sortBy": [],
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "DataType",
                        "formatter": 1
                      },
                      "subtitleContent": {
                        "columnMatch": "Solution"
                      },
                      "leftContent": {
                        "columnMatch": "IngestionVolume",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "magenta"
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "style": "decimal",
                            "maximumFractionDigits": 2,
                            "maximumSignificantDigits": 3
                          }
                        }
                      },
                      "showBorder": false
                    },
                    "graphSettings": {
                      "type": 0,
                      "topContent": {
                        "columnMatch": "Solution",
                        "formatter": 1
                      },
                      "centerContent": {
                        "columnMatch": "IngestionVolume",
                        "formatter": 1,
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "maximumSignificantDigits": 3,
                            "maximumFractionDigits": 2
                          }
                        }
                      }
                    },
                    "mapSettings": {
                      "locInfo": "LatLong",
                      "sizeSettings": "IngestionVolume",
                      "sizeAggregation": "Sum",
                      "legendMetric": "IngestionVolume",
                      "legendAggregation": "Sum",
                      "itemColorSettings": {
                        "type": "heatmap",
                        "colorAggregation": "Sum",
                        "nodeColorField": "IngestionVolume",
                        "heatmapPalette": "greenRed"
                      }
                    }
                  },
                  "customWidth": "40",
                  "conditionalVisibility": {
                    "parameterName": "visible",
                    "comparison": "isEqualTo",
                    "value": "never"
                  },
                  "name": "lawBillableTables"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "where type =~ 'microsoft.operationalinsights/workspaces'\r\n| extend \r\n  state = trim(' ', tostring(properties.provisioningState)),\r\n  sku = trim(' ', tostring(properties.sku.name)),\r\n  skuUpdate = trim(' ', tostring(properties.sku.lastSkuUpdate)),\r\n  retentionDays = trim(' ', tostring(properties.retentionInDays)),\r\n  dailyquotaGB  = trim(' ', tostring(properties.workspaceCapping.dailyQuotaGb))\r\n| extend dailyquotaGB = iif(dailyquotaGB !=-1.0, dailyquotaGB,\"--\")\r\n| project ['Workspace']=id, Name=name, ['Resource Group']=strcat(\"/subscriptions/\", subscriptionId, \"/resourceGroups/\", resourceGroup), ['Retention (days)']= toint(retentionDays), ['Daily Cap (GB)']=dailyquotaGB, ['Licence']=sku, Subscription=strcat(\"/subscriptions/\", subscriptionId)\r\n| order by ['Retention (days)'] desc",
                    "size": 0,
                    "title": "Log Analytics Workspace - Configuration",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Subscription}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Workspace",
                          "formatter": 13,
                          "formatOptions": {
                            "linkTarget": "Resource",
                            "subTarget": "insights",
                            "linkIsContextBlade": true,
                            "showIcon": true
                          }
                        },
                        {
                          "columnMatch": "Name",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "Resource Group",
                          "formatter": 14,
                          "formatOptions": {
                            "linkTarget": null,
                            "showIcon": true
                          }
                        },
                        {
                          "columnMatch": "Retention (days)",
                          "formatter": 4,
                          "formatOptions": {
                            "min": 1,
                            "max": 730,
                            "palette": "blue",
                            "customColumnWidthSetting": "10%"
                          }
                        },
                        {
                          "columnMatch": "Daily Cap (GB)",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "10%"
                          }
                        },
                        {
                          "columnMatch": "Licence",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "pergb2018",
                                "representation": "turquoise",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "premium",
                                "representation": "lightBlue",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "lacluster",
                                "representation": "red",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "standard",
                                "representation": "green",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "free",
                                "representation": "blue",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "capacityreservation",
                                "representation": "yellow",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "pernode",
                                "representation": "orange",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "standalone",
                                "representation": "purple",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "blue",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        }
                      ],
                      "sortBy": [
                        {
                          "itemKey": "$gen_bar_Retention (days)_3",
                          "sortOrder": 2
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "$gen_bar_Retention (days)_3",
                        "sortOrder": 2
                      }
                    ]
                  },
                  "customWidth": "80",
                  "conditionalVisibility": {
                    "parameterName": "visible",
                    "comparison": "isEqualTo",
                    "value": "never"
                  },
                  "name": "lawKQL"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"a9eaf340-2a55-4dc1-a3c2-392293a5a711\",\"mergeType\":\"innerunique\",\"leftTable\":\"lawBillableTables\",\"rightTable\":\"lawKQL\",\"leftColumn\":\"ResourceUri\",\"rightColumn\":\"Workspace\"}],\"projectRename\":[{\"originalName\":\"[lawBillableTables].ResourceUri\",\"mergedName\":\"ResourceUri\",\"fromId\":\"a9eaf340-2a55-4dc1-a3c2-392293a5a711\"},{\"originalName\":\"[lawBillableTables].IngestionVolume\",\"mergedName\":\"IngestionVolume\",\"fromId\":\"a9eaf340-2a55-4dc1-a3c2-392293a5a711\"},{\"originalName\":\"[lawKQL].Workspace\",\"mergedName\":\"Workspace\",\"fromId\":\"a9eaf340-2a55-4dc1-a3c2-392293a5a711\"},{\"originalName\":\"[lawKQL].Name\",\"mergedName\":\"Name\",\"fromId\":\"a9eaf340-2a55-4dc1-a3c2-392293a5a711\"},{\"originalName\":\"[lawKQL].Resource Group\",\"mergedName\":\"Resource Group\",\"fromId\":\"a9eaf340-2a55-4dc1-a3c2-392293a5a711\"},{\"originalName\":\"[lawKQL].Retention (days)\",\"mergedName\":\"Retention (days)\",\"fromId\":\"a9eaf340-2a55-4dc1-a3c2-392293a5a711\"},{\"originalName\":\"[lawKQL].Daily Cap (GB)\",\"mergedName\":\"Daily Cap (GB)\",\"fromId\":\"a9eaf340-2a55-4dc1-a3c2-392293a5a711\"},{\"originalName\":\"[lawKQL].Licence\",\"mergedName\":\"Licence\",\"fromId\":\"a9eaf340-2a55-4dc1-a3c2-392293a5a711\"},{\"originalName\":\"[lawKQL].Subscription\",\"mergedName\":\"Subscription\",\"fromId\":\"a9eaf340-2a55-4dc1-a3c2-392293a5a711\"}]}",
                    "size": 2,
                    "title": "Log Analytics Workspace Overview",
                    "exportFieldName": "ResourceUri",
                    "exportParameterName": "ResourceUri",
                    "showExportToExcel": true,
                    "queryType": 7,
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "IngestionVolume",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 4,
                            "options": {
                              "style": "decimal"
                            }
                          }
                        },
                        {
                          "columnMatch": "Workspace",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "Name",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "Resource Group",
                          "formatter": 5
                        }
                      ],
                      "rowLimit": 500,
                      "filter": true,
                      "sortBy": [
                        {
                          "itemKey": "$gen_number_IngestionVolume_1",
                          "sortOrder": 2
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "$gen_number_IngestionVolume_1",
                        "sortOrder": 2
                      }
                    ]
                  },
                  "customWidth": "50",
                  "showPin": false,
                  "name": "query - 7"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "Usage\r\n| where ResourceUri == \"{ResourceUri}\"\r\n| project DataType, Quantity\r\n| summarize IngestionVolume=sum(Quantity) by DataType\r\n| order by IngestionVolume",
                    "size": 0,
                    "showAnalytics": true,
                    "title": "LAW - Table Usage",
                    "noDataMessage": "Select a table from the above list",
                    "timeContextFromParameter": "TimeRange",
                    "exportFieldName": "DataType",
                    "exportParameterName": "TableInFocus",
                    "exportDefaultValue": "",
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{LogAnalyticsWorkspace}"
                    ],
                    "visualization": "table",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "ResourceUri",
                          "formatter": 13,
                          "formatOptions": {
                            "linkTarget": null,
                            "showIcon": true
                          }
                        },
                        {
                          "columnMatch": "DataType",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "25ch"
                          }
                        },
                        {
                          "columnMatch": "Volume",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "green",
                            "customColumnWidthSetting": "25ch"
                          },
                          "numberFormat": {
                            "unit": 38,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumFractionDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "Solution",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "IngestionPercent",
                          "formatter": 4,
                          "formatOptions": {
                            "palette": "turquoise",
                            "customColumnWidthSetting": "25ch"
                          },
                          "numberFormat": {
                            "unit": 17,
                            "options": {
                              "style": "percent",
                              "useGrouping": false,
                              "maximumFractionDigits": 1
                            }
                          }
                        },
                        {
                          "columnMatch": "Billable",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "true",
                                "representation": "Blank",
                                "text": "Billable"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "false",
                                "representation": "Blank",
                                "text": "Not billable"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Blank",
                                "text": "{0}{1}"
                              }
                            ],
                            "compositeBarSettings": {
                              "labelText": "",
                              "columnSettings": []
                            }
                          }
                        },
                        {
                          "columnMatch": "TimeSinceLastUpdate",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "<=",
                                "thresholdValue": "5400",
                                "representation": "Blank",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "<=",
                                "thresholdValue": "10800",
                                "representation": "Blank",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": ">",
                                "thresholdValue": "10800",
                                "representation": "Normal",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "Blank",
                                "text": "{0}{1}"
                              }
                            ]
                          },
                          "numberFormat": {
                            "unit": 24,
                            "options": {
                              "style": "decimal",
                              "useGrouping": false,
                              "maximumFractionDigits": 0
                            }
                          }
                        }
                      ],
                      "rowLimit": 500
                    },
                    "sortBy": [],
                    "tileSettings": {
                      "titleContent": {
                        "columnMatch": "DataType",
                        "formatter": 1
                      },
                      "subtitleContent": {
                        "columnMatch": "Solution"
                      },
                      "leftContent": {
                        "columnMatch": "IngestionVolume",
                        "formatter": 12,
                        "formatOptions": {
                          "palette": "magenta"
                        },
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "style": "decimal",
                            "maximumFractionDigits": 2,
                            "maximumSignificantDigits": 3
                          }
                        }
                      },
                      "showBorder": false
                    },
                    "graphSettings": {
                      "type": 0,
                      "topContent": {
                        "columnMatch": "Solution",
                        "formatter": 1
                      },
                      "centerContent": {
                        "columnMatch": "IngestionVolume",
                        "formatter": 1,
                        "numberFormat": {
                          "unit": 17,
                          "options": {
                            "maximumSignificantDigits": 3,
                            "maximumFractionDigits": 2
                          }
                        }
                      }
                    },
                    "mapSettings": {
                      "locInfo": "LatLong",
                      "sizeSettings": "IngestionVolume",
                      "sizeAggregation": "Sum",
                      "legendMetric": "IngestionVolume",
                      "legendAggregation": "Sum",
                      "itemColorSettings": {
                        "type": "heatmap",
                        "colorAggregation": "Sum",
                        "nodeColorField": "IngestionVolume",
                        "heatmapPalette": "greenRed"
                      }
                    }
                  },
                  "customWidth": "30",
                  "conditionalVisibility": {
                    "parameterName": "ResourceUri",
                    "comparison": "isNotEqualTo"
                  },
                  "name": "BillableTablesVolume - Copy"
                },
                {
                  "type": 1,
                  "content": {
                    "json": ""
                  },
                  "customWidth": "20",
                  "conditionalVisibility": {
                    "parameterName": "ResourceUri",
                    "comparison": "isEqualTo"
                  },
                  "name": "text - 8"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "# Azure Diagnostics\r\n\r\nAzure services have additional logs which get exported. These logs can sometimes cost more than expected and could be duplicated. ",
                    "style": "info"
                  },
                  "customWidth": "21",
                  "name": "text - 8"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let TotalGB=\r\n    AzureDiagnostics\r\n    | project _BilledSize, TimeGenerated\r\n    | where TimeGenerated {TimeRange:value}\r\n    | summarize sum(_BilledSize) / 1.E9;\r\nAzureDiagnostics\r\n| project _ResourceId, Category, _BilledSize\r\n| summarize ResourceGB=sum(_BilledSize) / 1.E9 by _ResourceId, Category\r\n| project Resource=_ResourceId, Category, \r\n    ['Percentage by size']=ResourceGB * 100 / toscalar(TotalGB), ['Log GB']=ResourceGB, ['Estimated cost'] = ResourceGB* 1.4099\r\n| sort by ['Log GB'] desc",
                    "size": 0,
                    "title": "Total Diagnostics Logs by Azure Resource",
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "crossComponentResources": [
                      "{LogAnalyticsWorkspace}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Percentage by size",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 1,
                            "options": {
                              "style": "decimal"
                            }
                          }
                        },
                        {
                          "columnMatch": "Log GB",
                          "formatter": 0,
                          "numberFormat": {
                            "unit": 5,
                            "options": {
                              "style": "decimal",
                              "maximumSignificantDigits": 2
                            }
                          }
                        },
                        {
                          "columnMatch": "Estimated cost",
                          "formatter": 1,
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "currency": "AUD",
                              "style": "currency"
                            }
                          }
                        }
                      ],
                      "filter": true,
                      "sortBy": [
                        {
                          "itemKey": "$gen_number_Estimated cost_4",
                          "sortOrder": 2
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "$gen_number_Estimated cost_4",
                        "sortOrder": 2
                      }
                    ]
                  },
                  "customWidth": "71",
                  "name": "query - 0"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "costTab",
              "comparison": "isEqualTo",
              "value": "logAnalytics"
            },
            "name": "logAnalyticsGroup"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# Orphan Resources\r\n\r\nResources that are detached or unused that are active and costing money. In the cloud you pay for any resources you have provisioned, even if they're not being actively used. \r\n\r\n> Note: These resources may still be in use and need to be investigated before being deleted. \r\n\r\n#### Resources to Manually Check\r\n\r\n- EventHubs\r\n\r\n<br>\r\n\r\n> **Expand the lists below to investigate.**"
                  },
                  "name": "text - 3"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "title": "Orphan Disks",
                    "expandable": true,
                    "expanded": true,
                    "items": [
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "resources \r\n| where type =~ 'microsoft.compute/disks' and managedBy == \"\"\r\n| extend diskState = tostring(properties.diskState)\r\n| where managedBy == \"\" and diskState != 'ActiveSAS'\r\nor diskState == 'Unattached' and diskState != 'ActiveSAS'\r\n| where resourceGroup !has \"vdi\"\r\n| extend DiskId=id, DiskName=name, SKUName=sku.name, SKUTier=sku.tier, DiskSizeGB=tostring(properties.diskSizeGB), Location=location, TimeCreated=tostring(properties.timeCreated)\r\n| project DiskId, DiskSizeGB, SKUName, SKUTier, resourceGroup, TimeCreated, subscriptionId\r\n",
                          "size": 0,
                          "showExportToExcel": true,
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "$gen_group",
                                "formatter": 15,
                                "formatOptions": {
                                  "linkTarget": null,
                                  "showIcon": true
                                }
                              },
                              {
                                "columnMatch": "subscriptionId",
                                "formatter": 5
                              }
                            ],
                            "rowLimit": 3000,
                            "filter": true,
                            "hierarchySettings": {
                              "treeType": 1,
                              "groupBy": [
                                "subscriptionId"
                              ],
                              "expandTopLevel": true
                            }
                          }
                        },
                        "name": "query - 1 - Copy"
                      }
                    ]
                  },
                  "name": "disks"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "title": "Orphan Public IPs",
                    "expandable": true,
                    "items": [
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "Resources\r\n| where type == \"microsoft.network/publicipaddresses\"\r\n| where properties.ipConfiguration == \"\" and properties.natGateway == \"\"\r\n| extend Details = pack_all()\r\n| project Resource=id, resourceGroup, location, subscriptionId, tostring(sku.name), AllocationMethod=tostring(properties.publicIPAllocationMethod)",
                          "size": 0,
                          "noDataMessage": "No oprhan Public IPs found",
                          "showExportToExcel": true,
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "$gen_group",
                                "formatter": 13,
                                "formatOptions": {
                                  "linkTarget": "Resource",
                                  "linkIsContextBlade": true,
                                  "showIcon": true
                                }
                              },
                              {
                                "columnMatch": "Resource",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "subscriptionId",
                                "formatter": 5
                              }
                            ],
                            "rowLimit": 1000,
                            "filter": true,
                            "hierarchySettings": {
                              "treeType": 1,
                              "groupBy": [
                                "subscriptionId"
                              ],
                              "expandTopLevel": true,
                              "finalBy": "Resource"
                            },
                            "sortBy": [
                              {
                                "itemKey": "resourceGroup",
                                "sortOrder": 2
                              }
                            ],
                            "labelSettings": [
                              {
                                "columnId": "Resource",
                                "label": "Public IP Name"
                              },
                              {
                                "columnId": "resourceGroup",
                                "label": "Resource Group"
                              },
                              {
                                "columnId": "location",
                                "label": "Location"
                              },
                              {
                                "columnId": "subscriptionId",
                                "label": "Subscription"
                              },
                              {
                                "columnId": "sku_name",
                                "label": "Type"
                              }
                            ]
                          },
                          "sortBy": [
                            {
                              "itemKey": "resourceGroup",
                              "sortOrder": 2
                            }
                          ],
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "vmSize",
                              "formatter": 1,
                              "formatOptions": {
                                "showIcon": true
                              }
                            },
                            "leftContent": {
                              "columnMatch": "Count",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto",
                                "showIcon": true
                              },
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "maximumSignificantDigits": 3,
                                  "maximumFractionDigits": 2
                                }
                              }
                            },
                            "showBorder": true
                          },
                          "graphSettings": {
                            "type": 0,
                            "topContent": {
                              "columnMatch": "vmSize",
                              "formatter": 1
                            },
                            "centerContent": {
                              "columnMatch": "Count",
                              "formatter": 1,
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "maximumSignificantDigits": 3,
                                  "maximumFractionDigits": 2
                                }
                              }
                            }
                          }
                        },
                        "name": "publicIPs"
                      }
                    ]
                  },
                  "name": "orphanedIPs"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "title": "Orphan App Service Plans",
                    "expandable": true,
                    "items": [
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "resources\r\n| where type =~ \"microsoft.web/serverfarms\"\r\n| where properties.numberOfSites == 0\r\n| extend Details = pack_all()\r\n| project Resource=id, resourceGroup, location, subscriptionId, Sku=sku.name, Tier=sku.tier",
                          "size": 3,
                          "noDataMessage": "No oprhan App Service Plans found",
                          "showExportToExcel": true,
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "$gen_group",
                                "formatter": 13,
                                "formatOptions": {
                                  "linkTarget": null,
                                  "showIcon": true
                                }
                              },
                              {
                                "columnMatch": "Resource",
                                "formatter": 5
                              },
                              {
                                "columnMatch": "subscriptionId",
                                "formatter": 5
                              }
                            ],
                            "rowLimit": 1000,
                            "filter": true,
                            "hierarchySettings": {
                              "treeType": 1,
                              "groupBy": [
                                "subscriptionId"
                              ],
                              "expandTopLevel": true,
                              "finalBy": "Resource"
                            },
                            "labelSettings": [
                              {
                                "columnId": "resourceGroup",
                                "label": "Resource Group"
                              },
                              {
                                "columnId": "location",
                                "label": "Location"
                              },
                              {
                                "columnId": "subscriptionId",
                                "label": "Subscription"
                              }
                            ]
                          },
                          "sortBy": [],
                          "tileSettings": {
                            "titleContent": {
                              "columnMatch": "vmSize",
                              "formatter": 1,
                              "formatOptions": {
                                "showIcon": true
                              }
                            },
                            "leftContent": {
                              "columnMatch": "Count",
                              "formatter": 12,
                              "formatOptions": {
                                "palette": "auto",
                                "showIcon": true
                              },
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "maximumSignificantDigits": 3,
                                  "maximumFractionDigits": 2
                                }
                              }
                            },
                            "showBorder": true
                          },
                          "graphSettings": {
                            "type": 0,
                            "topContent": {
                              "columnMatch": "vmSize",
                              "formatter": 1
                            },
                            "centerContent": {
                              "columnMatch": "Count",
                              "formatter": 1,
                              "numberFormat": {
                                "unit": 17,
                                "options": {
                                  "maximumSignificantDigits": 3,
                                  "maximumFractionDigits": 2
                                }
                              }
                            }
                          }
                        },
                        "name": "query - Orphan App Service Plans"
                      }
                    ]
                  },
                  "name": "LoadBalancers"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "title": "Orphan Application Gateways",
                    "expandable": true,
                    "items": [
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "resources\r\n| where type =~ 'Microsoft.Network/applicationGateways'\r\n| extend backendPoolsCount = array_length(properties.backendAddressPools),SKUName= tostring(properties.sku.name), SKUTier= tostring(properties.sku.tier),SKUCapacity=properties.sku.capacity,backendPools=properties.backendAddressPools\r\n| project id, name, SKUName, SKUTier, SKUCapacity\r\n| join (\r\n    resources\r\n    | where type =~ 'Microsoft.Network/applicationGateways' \r\n    | mvexpand backendPools = properties.backendAddressPools\r\n    | extend backendIPCount = array_length(backendPools.properties.backendIPConfigurations)\r\n    | extend backendAddressesCount = array_length(backendPools.properties.backendAddresses)\r\n    | extend backendPoolName  = backendPools.properties.backendAddressPools.name\r\n    | summarize backendIPCount = sum(backendIPCount) ,backendAddressesCount=sum(backendAddressesCount) by id\r\n) on id\r\n| project-away id1\r\n| where  (backendIPCount == 0 or isempty(backendIPCount)) and (backendAddressesCount==0 or isempty(backendAddressesCount))\r\n| order by id asc",
                          "size": 3,
                          "noDataMessage": "You don't have any Application Gateways with empty backendpools",
                          "noDataMessageStyle": 3,
                          "showExportToExcel": true,
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "SKUCapacity",
                                "formatter": 1
                              },
                              {
                                "columnMatch": "backendIPCount",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "0",
                                      "representation": "disabled",
                                      "text": ""
                                    },
                                    {
                                      "operator": ">",
                                      "thresholdValue": "0",
                                      "representation": "success",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "success",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "backendAddressesCount",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "0",
                                      "representation": "disabled",
                                      "text": ""
                                    },
                                    {
                                      "operator": ">",
                                      "thresholdValue": "0",
                                      "representation": "success",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "success",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "Recommendation",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "colors",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "No Backend targets",
                                      "representation": "redBright",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "green",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "backendPoolIPTarget",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": ">",
                                      "thresholdValue": "0",
                                      "representation": "success",
                                      "text": ""
                                    },
                                    {
                                      "operator": "==",
                                      "thresholdValue": "0",
                                      "representation": "disabled",
                                      "text": ""
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "success",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "backendPoolVMTarget",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "icons",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "is Empty",
                                      "representation": "disabled",
                                      "text": ""
                                    },
                                    {
                                      "operator": ">",
                                      "thresholdValue": "0",
                                      "representation": "success",
                                      "text": ""
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "success",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              },
                              {
                                "columnMatch": "Recommednation",
                                "formatter": 18,
                                "formatOptions": {
                                  "thresholdsOptions": "colors",
                                  "thresholdsGrid": [
                                    {
                                      "operator": "==",
                                      "thresholdValue": "No Backend targets",
                                      "representation": "redBright",
                                      "text": "{0}{1}"
                                    },
                                    {
                                      "operator": "Default",
                                      "thresholdValue": null,
                                      "representation": "green",
                                      "text": "{0}{1}"
                                    }
                                  ]
                                }
                              }
                            ]
                          }
                        },
                        "name": "query - 1"
                      }
                    ]
                  },
                  "name": "Orphaned Application Gateways"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "title": "Orphan Load Balancers",
                    "expandable": true,
                    "items": [
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "resources \r\n| where type =~ 'microsoft.network/loadbalancers' and tostring(properties.backendAddressPools) == '[]' \r\n| extend Details=id,LBRG=resourceGroup, LoadBalancerName=name, SKU=sku, LBLocation=location\r\n| order by id asc\r\n| project Details,LoadBalancerName, SKU.name,SKU.tier, LBLocation,LBRG, subscriptionId\r\n",
                          "size": 3,
                          "noDataMessage": "There are no load balances with empty backend pools",
                          "noDataMessageStyle": 3,
                          "showExportToExcel": true,
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ],
                          "gridSettings": {
                            "formatters": [
                              {
                                "columnMatch": "subscriptionId",
                                "formatter": 15,
                                "formatOptions": {
                                  "linkTarget": null,
                                  "showIcon": true
                                }
                              }
                            ]
                          }
                        },
                        "name": "query - 3"
                      }
                    ]
                  },
                  "name": "group - 6"
                },
                {
                  "type": 12,
                  "content": {
                    "version": "NotebookGroup/1.0",
                    "groupType": "editable",
                    "title": "Orphan Frontdoors",
                    "expandable": true,
                    "items": [
                      {
                        "type": 3,
                        "content": {
                          "version": "KqlItem/1.0",
                          "query": "resources\r\n| where type == \"microsoft.network/frontdoors\"\r\n| project name, resourceGroup, subscriptionId, backendPoolCount = array_length(properties.backendPools)\r\n| where backendPoolCount == 0\r\n",
                          "size": 3,
                          "noDataMessage": "There are no Orphan Frontdoors instances",
                          "noDataMessageStyle": 3,
                          "queryType": 1,
                          "resourceType": "microsoft.resourcegraph/resources",
                          "crossComponentResources": [
                            "{Subscription}"
                          ]
                        },
                        "name": "query - 0"
                      }
                    ]
                  },
                  "name": "frontDoor"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "costTab",
              "comparison": "isEqualTo",
              "value": "orphaned"
            },
            "name": "costOrphanedResources"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "# General Insights\r\n\r\nThis page groups cost insights and ideas for various services. "
                  },
                  "name": "text - 5"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "## Test/POC/Delete Resources\r\n\r\nWhen teams are using the cloud most `temporary` resoruces are appended with a name that reflects this. The queries in this row visualize any of these resources to ensure that teams are aware that they're still active (or that they exist). ",
                    "style": "info"
                  },
                  "customWidth": "20",
                  "name": "text - 6"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "resources\r\n| where name has \"poc\" or name has \"abc\" or name has \"delete\" or name has \"test\" or name has \"temp\"\r\n| summarize count()",
                    "size": 4,
                    "title": "Test/POC/Delete - Resources",
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Subscription}"
                    ],
                    "visualization": "tiles",
                    "tileSettings": {
                      "titleContent": {},
                      "leftContent": {
                        "columnMatch": "count_",
                        "formatter": 12,
                        "formatOptions": {
                          "max": 100,
                          "palette": "red"
                        }
                      },
                      "showBorder": false
                    }
                  },
                  "customWidth": "20",
                  "name": "query - 2 - Copy"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "resources\r\n| where name has \"poc\" or name has \"abc\" or name has \"delete\" or name has \"test\" or name has \"temp\"",
                    "size": 0,
                    "title": "Test/POC/Delete - Resources",
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Subscription}"
                    ],
                    "gridSettings": {
                      "hierarchySettings": {
                        "treeType": 1,
                        "groupBy": [
                          "type"
                        ]
                      }
                    }
                  },
                  "customWidth": "60",
                  "name": "query - 2"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "## Application Insights\r\n\r\n\r\n\r\n- **Sampling**: Consider reducing the `Sampling` rate for Application Insight instances in lower environments.\r\n- **Retention**: Retention over 90 days incurs additional fees. ",
                    "style": "info"
                  },
                  "customWidth": "20",
                  "name": "text - 8"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "resources\r\n| where type == \"microsoft.insights/components\"\r\n| project id, SamplingPercentage = properties.SamplingPercentage, RetentionInDays = properties.RetentionInDays, resourceGroup, subscriptionId",
                    "size": 1,
                    "title": "Application Insights - Sampling",
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Subscription}"
                    ],
                    "gridSettings": {
                      "rowLimit": 1000
                    }
                  },
                  "customWidth": "80",
                  "name": "query - 9"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "## VPN Gateways\r\n\r\nReview VPN Gateways without network traffic. These gateways are billed hourly, consider reconfiguring or deleting them if they are not in use.\r\n\r\n- **Utilisation**: Reduce the size if it's over provisioned\r\n- **Usage**: Is the gateway still in use? ",
                    "style": "info"
                  },
                  "customWidth": "20",
                  "name": "text - 6"
                },
                {
                  "type": 10,
                  "content": {
                    "chartId": "workbooka9ea46a6-d16a-43b9-a30d-81475a76a12a",
                    "version": "MetricsItem/2.0",
                    "size": 0,
                    "chartType": 0,
                    "resourceType": "microsoft.network/virtualnetworkgateways",
                    "metricScope": 0,
                    "resourceParameter": "VPNGateways",
                    "resourceIds": [
                      "{VPNGateways}"
                    ],
                    "timeContextFromParameter": "TimeRange",
                    "timeContext": {
                      "durationMs": 14400000
                    },
                    "metrics": [
                      {
                        "namespace": "microsoft.network/virtualnetworkgateways",
                        "metric": "microsoft.network/virtualnetworkgateways-Traffic-TunnelTotalFlowCount",
                        "aggregation": 7
                      },
                      {
                        "namespace": "microsoft.network/virtualnetworkgateways",
                        "metric": "microsoft.network/virtualnetworkgateways-Traffic-TunnelAverageBandwidth",
                        "aggregation": 4
                      },
                      {
                        "namespace": "microsoft.network/virtualnetworkgateways",
                        "metric": "microsoft.network/virtualnetworkgateways-Traffic-P2SBandwidth",
                        "aggregation": 4
                      },
                      {
                        "namespace": "microsoft.network/virtualnetworkgateways",
                        "metric": "microsoft.network/virtualnetworkgateways-Traffic-AverageBandwidth",
                        "aggregation": 4
                      }
                    ],
                    "title": "Virtual network gateways",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Subscription",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "Name",
                          "formatter": 13,
                          "formatOptions": {
                            "linkTarget": "Resource"
                          }
                        },
                        {
                          "columnMatch": "microsoft.network/virtualnetworkgateways-Traffic-TunnelTotalFlowCount Timeline",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "microsoft.network/virtualnetworkgateways-Traffic-TunnelTotalFlowCount",
                          "formatter": 1,
                          "numberFormat": {
                            "unit": 0,
                            "options": null
                          }
                        },
                        {
                          "columnMatch": "microsoft.network/virtualnetworkgateways-Traffic-TunnelAverageBandwidth Timeline",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "microsoft.network/virtualnetworkgateways-Traffic-TunnelAverageBandwidth",
                          "formatter": 1,
                          "numberFormat": {
                            "unit": 11,
                            "options": null
                          }
                        },
                        {
                          "columnMatch": "microsoft.network/virtualnetworkgateways-Traffic-P2SConnectionCount Timeline",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "microsoft.network/virtualnetworkgateways-Traffic-P2SConnectionCount",
                          "formatter": 1,
                          "numberFormat": {
                            "unit": 0,
                            "options": null
                          }
                        },
                        {
                          "columnMatch": "microsoft.network/virtualnetworkgateways-Traffic-P2SBandwidth Timeline",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "microsoft.network/virtualnetworkgateways-Traffic-P2SBandwidth",
                          "formatter": 1,
                          "numberFormat": {
                            "unit": 11,
                            "options": null
                          }
                        },
                        {
                          "columnMatch": "microsoft.network/virtualnetworkgateways-Traffic-AverageBandwidth Timeline",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "microsoft.network/virtualnetworkgateways-Traffic-AverageBandwidth",
                          "formatter": 1,
                          "numberFormat": {
                            "unit": 11,
                            "options": null
                          }
                        },
                        {
                          "columnMatch": "Metric",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "Aggregation",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "Value",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "Timeline",
                          "formatter": 9
                        },
                        {
                          "columnMatch": "microsoft.network/virtualnetworkgateways-Performance-ExpressRouteGatewayPacketsPerSecond",
                          "formatter": 1,
                          "numberFormat": {
                            "unit": 31,
                            "options": null
                          }
                        }
                      ],
                      "rowLimit": 10000,
                      "labelSettings": [
                        {
                          "columnId": "microsoft.network/virtualnetworkgateways-Traffic-TunnelTotalFlowCount",
                          "label": "Tunnel Total Flow Count (Count)"
                        },
                        {
                          "columnId": "microsoft.network/virtualnetworkgateways-Traffic-TunnelTotalFlowCount Timeline",
                          "label": "Tunnel Total Flow Count Timeline"
                        },
                        {
                          "columnId": "microsoft.network/virtualnetworkgateways-Traffic-TunnelAverageBandwidth",
                          "label": "Tunnel Bandwidth (Average)"
                        },
                        {
                          "columnId": "microsoft.network/virtualnetworkgateways-Traffic-TunnelAverageBandwidth Timeline",
                          "label": "Tunnel Bandwidth Timeline"
                        },
                        {
                          "columnId": "microsoft.network/virtualnetworkgateways-Traffic-P2SBandwidth",
                          "label": "Gateway P2S Bandwidth (Average)"
                        },
                        {
                          "columnId": "microsoft.network/virtualnetworkgateways-Traffic-P2SBandwidth Timeline",
                          "label": "Gateway P2S Bandwidth Timeline"
                        },
                        {
                          "columnId": "microsoft.network/virtualnetworkgateways-Traffic-AverageBandwidth",
                          "label": "Gateway S2S Bandwidth (Average)"
                        },
                        {
                          "columnId": "microsoft.network/virtualnetworkgateways-Traffic-AverageBandwidth Timeline",
                          "label": "Gateway S2S Bandwidth Timeline"
                        }
                      ]
                    }
                  },
                  "customWidth": "80",
                  "name": "metric - 11 - Copy"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "## Firewalls\r\n\r\nReview Azure Firewall without network traffic. These resources are billed hourly, consider reconfiguring or deleting them if they are not in use.\r\n\r\n- **SKU**: Look at reducing the SKU were applicable. ",
                    "style": "info"
                  },
                  "customWidth": "20",
                  "name": "text - 8"
                },
                {
                  "type": 10,
                  "content": {
                    "chartId": "workbookc9b8f2a1-5ab7-4815-8ea2-474bcfca994b",
                    "version": "MetricsItem/2.0",
                    "size": 1,
                    "chartType": 0,
                    "resourceType": "microsoft.network/azurefirewalls",
                    "metricScope": 0,
                    "resourceParameter": "Firewalls",
                    "resourceIds": [
                      "{Firewalls}"
                    ],
                    "timeContextFromParameter": "TimeRange",
                    "timeContext": {
                      "durationMs": 14400000
                    },
                    "metrics": [
                      {
                        "namespace": "microsoft.network/azurefirewalls",
                        "metric": "microsoft.network/azurefirewalls--DataProcessed",
                        "aggregation": 1
                      },
                      {
                        "namespace": "microsoft.network/azurefirewalls",
                        "metric": "microsoft.network/azurefirewalls--Throughput",
                        "aggregation": 4
                      }
                    ],
                    "title": "Azure Firewalls",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Subscription",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "Name",
                          "formatter": 13,
                          "formatOptions": {
                            "linkTarget": "Resource",
                            "showIcon": true
                          }
                        },
                        {
                          "columnMatch": "microsoft.network/azurefirewalls--DataProcessed",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "is Empty",
                                "representation": "more",
                                "text": "Not In Use"
                              },
                              {
                                "operator": "<",
                                "thresholdValue": "5000000",
                                "representation": "warning",
                                "text": "Low"
                              },
                              {
                                "operator": ">=",
                                "thresholdValue": "5000000",
                                "representation": "success",
                                "text": "Active"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": null,
                                "text": ""
                              }
                            ]
                          },
                          "numberFormat": {
                            "unit": 2,
                            "options": {
                              "style": "decimal"
                            },
                            "emptyValCustomText": "0"
                          }
                        },
                        {
                          "columnMatch": "microsoft.network/azurefirewalls--DataProcessed Timeline",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "microsoft.network/azurefirewalls--Throughput",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "is Empty",
                                "representation": "more",
                                "text": "Not In Use"
                              },
                              {
                                "operator": "<",
                                "thresholdValue": "5000000",
                                "representation": "warning",
                                "text": "Low"
                              },
                              {
                                "operator": ">=",
                                "thresholdValue": "5000000",
                                "representation": "success",
                                "text": "Active"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": null,
                                "text": "{0}{1}"
                              }
                            ]
                          },
                          "numberFormat": {
                            "unit": 0,
                            "options": {
                              "style": "decimal"
                            },
                            "emptyValCustomText": "0"
                          }
                        },
                        {
                          "columnMatch": "microsoft.network/azurefirewalls--Throughput Timeline",
                          "formatter": 5
                        }
                      ],
                      "rowLimit": 10000,
                      "labelSettings": [
                        {
                          "columnId": "Subscription",
                          "label": "Subscription"
                        },
                        {
                          "columnId": "microsoft.network/azurefirewalls--DataProcessed",
                          "label": "Data processed (Sum)"
                        },
                        {
                          "columnId": "microsoft.network/azurefirewalls--DataProcessed Timeline",
                          "label": "Data processed Timeline"
                        },
                        {
                          "columnId": "microsoft.network/azurefirewalls--Throughput",
                          "label": "Throughput (Average)"
                        },
                        {
                          "columnId": "microsoft.network/azurefirewalls--Throughput Timeline",
                          "label": "Throughput Timeline"
                        }
                      ]
                    }
                  },
                  "customWidth": "80",
                  "name": "metric - 7"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "costTab",
              "comparison": "isEqualTo",
              "value": "insights"
            },
            "name": "costInsightsGroup"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "![aks-logo](https://finopsworkbookcontent.blob.core.windows.net/finops-workbook/Kubernetes-Services-small.png)\r\n# Azure Kubernetes Service\r\n\r\nAzure Kubernetes Service (AKS) is a complex system and all recommendations need to be investigated to confirm they're applicable for your usecase. \r\n\r\n- **[Cluster Autoscaler](https://learn.microsoft.com/en-us/azure/aks/cluster-autoscaler)**: Enable cluster autoscaler to automatically adjust the number of agent nodes in response to resource constraints.\r\n- **[Spot NodePool](https://learn.microsoft.com/en-us/azure/aks/spot-node-pool)**: Consider using Azure Spot VMs for workloads that can handle interruptions, early terminations, or evictions. For example, workloads such as batch processing jobs, development and testing environments, and large compute workloads may be good candidates to be scheduled on a spot node pool.\r\n- **[Horizontal Pod Autoscalers](https://learn.microsoft.com/en-us/azure/aks/concepts-scale)**: Utilize the Horizontal pod autoscaler to adjust the number of pods in a deployment depending on CPU utilization or other select metrics.\r\n- **[Stop/Start Feature](https://learn.microsoft.com/en-us/azure/aks/start-stop-cluster)**: Use the Start/Stop feature in Azure Kubernetes Services (AKS) to toggle the cluster or a specific NodePool.\r\n- **[System NodePool Recommendations](https://learn.microsoft.com/en-us/azure/aks/use-system-pools?tabs=azure-cli#system-and-user-node-pools)**: System Node Pools are used to run cluster critical workloads. Applications should run on UserNodes. Microsoft provides explicit guidance on sizing a System NodePool. \r\n- **[Reservations](https://learn.microsoft.com/en-us/azure/cost-management-billing/reservations/manage-reserved-vm-instance)**: Review reservations for the System Node Pool instances and `base` user pool nodes (instances that run 24/7 and aren't added based on load).\r\n- **[AKS Paid SKU - Lower Environments](https://learn.microsoft.com/en-us/azure/aks/uptime-sla)**: Consider decreasing the clusters availability in lower environments (Tier: Free vs Paid).\r\n- **[Node Scaling](https://learn.microsoft.com/en-us/azure/aks/cluster-autoscaler)**: When a cluster has autoscaling enabled the nodeCount should grow above the `minCount` value. If the `minCount` and `currentCount` are always the same size, the cluster may be over provisioned. \r\n- **[Evaluate Pod Request/Limit settings](https://learn.microsoft.com/en-us/azure/aks/developer-best-practices-resource-management#define-pod-resource-requests-and-limits)**: The cluster autoscaler works on pending pods. When a pod starts the Kubernetes Scheduler looks at the request/limit to determine if it can schedule the workload. If these values are set to high, it causes the cluster to be underutilised (low CPU and Memory consumption).\r\n- **[Max Pods](https://learn.microsoft.com/en-us/azure/aks/configure-azure-cni#maximum-pods-per-node)**: Nodepools are created with a `maxPods` count. Once this count is hit pods cannot be scheduled on a node. So if this value is too low, it may cause waste (remember each Node has atleast 6 pods due to `daemonsets`).\r\n- **[AKS Logging - Blog](https://techcommunity.microsoft.com/t5/fasttrack-for-azure/aks-container-insights-logging-level-and-associated-costs/ba-p/3684224)**: Applications running on AKS can cause unexpected logging costs. \r\n\r\n",
                    "style": "info"
                  },
                  "name": "text - 11"
                },
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "crossComponentResources": [
                      "{Subscription}"
                    ],
                    "parameters": [
                      {
                        "id": "33910715-cd58-444a-a58c-009a44551924",
                        "version": "KqlParameterItem/1.0",
                        "name": "AKSCluster",
                        "type": 5,
                        "multiSelect": true,
                        "quote": "'",
                        "delimiter": ",",
                        "query": "resources\r\n| where type == \"microsoft.containerservice/managedclusters\"\r\n| project id, name",
                        "crossComponentResources": [
                          "{Subscription}"
                        ],
                        "typeSettings": {
                          "additionalResourceOptions": [
                            "value::all"
                          ]
                        },
                        "timeContext": {
                          "durationMs": 86400000
                        },
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources",
                        "value": [
                          "value::all"
                        ]
                      }
                    ],
                    "style": "pills",
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources"
                  },
                  "name": "parameters - 3"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "## Cluster Utilization\r\n\r\nEvaluate whether the CPU and Memory metrics to ensure the cluster is being utilised at expected. If the nodes are less than 50% utilization it could mean there's an opportunity to improve pod density. \r\n\r\n- Evaluate the pod `request/limit` values to determine if the [resource values](https://learn.microsoft.com/en-us/azure/aks/developer-best-practices-resource-management#define-pod-resource-requests-and-limits) have been over provisioned\r\n- Check the `maxPods` setting for the nodepools to ensure this isn't being hit",
                    "style": "info"
                  },
                  "customWidth": "20",
                  "name": "text - 5"
                },
                {
                  "type": 10,
                  "content": {
                    "chartId": "workbookd3a2514f-1058-46f7-ad25-c4948b34c8a9",
                    "version": "MetricsItem/2.0",
                    "size": 0,
                    "chartType": 2,
                    "resourceType": "microsoft.containerservice/managedclusters",
                    "metricScope": 0,
                    "resourceParameter": "AKSCluster",
                    "resourceIds": [
                      "{AKSCluster}"
                    ],
                    "timeContextFromParameter": "TimeRange",
                    "timeContext": {
                      "durationMs": 172800000
                    },
                    "metrics": [
                      {
                        "namespace": "microsoft.containerservice/managedclusters",
                        "metric": "microsoft.containerservice/managedclusters-Nodes (PREVIEW)-node_cpu_usage_percentage",
                        "aggregation": 4,
                        "splitBy": null
                      }
                    ],
                    "title": "Average CPU Used %",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Subscription",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "Name",
                          "formatter": 13,
                          "formatOptions": {
                            "linkTarget": "Resource"
                          }
                        },
                        {
                          "columnMatch": "microsoft.containerservice/managedclusters-Nodes (PREVIEW)-node_cpu_usage_percentage Timeline",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "microsoft.containerservice/managedclusters-Nodes (PREVIEW)-node_cpu_usage_percentage",
                          "formatter": 1,
                          "numberFormat": {
                            "unit": 1,
                            "options": null
                          }
                        },
                        {
                          "columnMatch": "microsoft.containerservice/managedclusters-Nodes (PREVIEW)-node_memory_working_set_percentage Timeline",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "microsoft.containerservice/managedclusters-Nodes (PREVIEW)-node_memory_working_set_percentage",
                          "formatter": 1,
                          "numberFormat": {
                            "unit": 1,
                            "options": null
                          }
                        },
                        {
                          "columnMatch": ".*\\/CPU Usage Percentage$",
                          "formatter": 1
                        }
                      ],
                      "rowLimit": 10000,
                      "labelSettings": [
                        {
                          "columnId": "microsoft.containerservice/managedclusters-Nodes (PREVIEW)-node_cpu_usage_percentage",
                          "label": "CPU Usage Percentage (Average)"
                        },
                        {
                          "columnId": "microsoft.containerservice/managedclusters-Nodes (PREVIEW)-node_cpu_usage_percentage Timeline",
                          "label": "CPU Usage Percentage Timeline"
                        },
                        {
                          "columnId": "microsoft.containerservice/managedclusters-Nodes (PREVIEW)-node_memory_working_set_percentage",
                          "label": "Memory Working Set Percentage (Average)"
                        },
                        {
                          "columnId": "microsoft.containerservice/managedclusters-Nodes (PREVIEW)-node_memory_working_set_percentage Timeline",
                          "label": "Memory Working Set Percentage Timeline"
                        }
                      ]
                    }
                  },
                  "customWidth": "40",
                  "name": "metric - 2"
                },
                {
                  "type": 10,
                  "content": {
                    "chartId": "workbookd3a2514f-1058-46f7-ad25-c4948b34c8a9",
                    "version": "MetricsItem/2.0",
                    "size": 0,
                    "chartType": 2,
                    "resourceType": "microsoft.containerservice/managedclusters",
                    "metricScope": 0,
                    "resourceParameter": "AKSCluster",
                    "resourceIds": [
                      "{AKSCluster}"
                    ],
                    "timeContextFromParameter": "TimeRange",
                    "timeContext": {
                      "durationMs": 172800000
                    },
                    "metrics": [
                      {
                        "namespace": "microsoft.containerservice/managedclusters",
                        "metric": "microsoft.containerservice/managedclusters-Nodes (PREVIEW)-node_memory_working_set_percentage",
                        "aggregation": 4,
                        "splitBy": null
                      }
                    ],
                    "title": "Average Memory Used %",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Subscription",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "Name",
                          "formatter": 13,
                          "formatOptions": {
                            "linkTarget": "Resource"
                          }
                        },
                        {
                          "columnMatch": "microsoft.containerservice/managedclusters-Nodes (PREVIEW)-node_cpu_usage_percentage Timeline",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "microsoft.containerservice/managedclusters-Nodes (PREVIEW)-node_cpu_usage_percentage",
                          "formatter": 1,
                          "numberFormat": {
                            "unit": 1,
                            "options": null
                          }
                        },
                        {
                          "columnMatch": "microsoft.containerservice/managedclusters-Nodes (PREVIEW)-node_memory_working_set_percentage Timeline",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "microsoft.containerservice/managedclusters-Nodes (PREVIEW)-node_memory_working_set_percentage",
                          "formatter": 1,
                          "numberFormat": {
                            "unit": 1,
                            "options": null
                          }
                        },
                        {
                          "columnMatch": ".*\\/CPU Usage Percentage$",
                          "formatter": 1
                        }
                      ],
                      "rowLimit": 10000,
                      "labelSettings": [
                        {
                          "columnId": "microsoft.containerservice/managedclusters-Nodes (PREVIEW)-node_cpu_usage_percentage",
                          "label": "CPU Usage Percentage (Average)"
                        },
                        {
                          "columnId": "microsoft.containerservice/managedclusters-Nodes (PREVIEW)-node_cpu_usage_percentage Timeline",
                          "label": "CPU Usage Percentage Timeline"
                        },
                        {
                          "columnId": "microsoft.containerservice/managedclusters-Nodes (PREVIEW)-node_memory_working_set_percentage",
                          "label": "Memory Working Set Percentage (Average)"
                        },
                        {
                          "columnId": "microsoft.containerservice/managedclusters-Nodes (PREVIEW)-node_memory_working_set_percentage Timeline",
                          "label": "Memory Working Set Percentage Timeline"
                        }
                      ]
                    }
                  },
                  "customWidth": "40",
                  "name": "metric - 2 - Copy"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "## Node & Pod Density\r\n\r\nAKS is built to horizontally scale based on demand. So the following panels should show the Node and Pod counts scaling in and out (as the load increases).\r\n\r\n- If they're static it may mean the cluster scaling needs to be tuned",
                    "style": "info"
                  },
                  "customWidth": "20",
                  "name": "text - 8"
                },
                {
                  "type": 10,
                  "content": {
                    "chartId": "workbookd3a2514f-1058-46f7-ad25-c4948b34c8a9",
                    "version": "MetricsItem/2.0",
                    "size": 0,
                    "chartType": 2,
                    "resourceType": "microsoft.containerservice/managedclusters",
                    "metricScope": 0,
                    "resourceParameter": "AKSCluster",
                    "resourceIds": [
                      "{AKSCluster}"
                    ],
                    "timeContextFromParameter": "TimeRange",
                    "timeContext": {
                      "durationMs": 172800000
                    },
                    "metrics": [
                      {
                        "namespace": "microsoft.containerservice/managedclusters",
                        "metric": "microsoft.containerservice/managedclusters-Nodes-kube_node_status_condition",
                        "aggregation": 4,
                        "splitBy": null,
                        "columnName": "Nodes"
                      }
                    ],
                    "title": "Node Count by Cluster",
                    "filters": [
                      {
                        "id": "1",
                        "key": "status2",
                        "operator": 0,
                        "values": [
                          "Ready",
                          "NotReady"
                        ]
                      }
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Subscription",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "Name",
                          "formatter": 13,
                          "formatOptions": {
                            "linkTarget": "Resource"
                          }
                        },
                        {
                          "columnMatch": "microsoft.containerservice/managedclusters-Nodes (PREVIEW)-node_cpu_usage_percentage Timeline",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "microsoft.containerservice/managedclusters-Nodes (PREVIEW)-node_cpu_usage_percentage",
                          "formatter": 1,
                          "numberFormat": {
                            "unit": 1,
                            "options": null
                          }
                        },
                        {
                          "columnMatch": "microsoft.containerservice/managedclusters-Nodes (PREVIEW)-node_memory_working_set_percentage Timeline",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "microsoft.containerservice/managedclusters-Nodes (PREVIEW)-node_memory_working_set_percentage",
                          "formatter": 1,
                          "numberFormat": {
                            "unit": 1,
                            "options": null
                          }
                        },
                        {
                          "columnMatch": ".*\\/CPU Usage Percentage$",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "microsoft.containerservice/managedclusters-Nodes-kube_node_status_condition Timeline",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "microsoft.containerservice/managedclusters-Nodes-kube_node_status_condition",
                          "formatter": 1,
                          "numberFormat": {
                            "unit": 0,
                            "options": null
                          }
                        },
                        {
                          "columnMatch": ".*\\/Statuses for various node conditions$",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "Nodes Timeline",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "Nodes",
                          "formatter": 1,
                          "numberFormat": {
                            "unit": 0,
                            "options": null
                          }
                        },
                        {
                          "columnMatch": "Metric",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "Aggregation",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "Value",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "Timeline",
                          "formatter": 9
                        }
                      ],
                      "rowLimit": 10000,
                      "labelSettings": [
                        {
                          "columnId": "Subscription",
                          "label": "Subscription"
                        }
                      ]
                    }
                  },
                  "customWidth": "40",
                  "name": "metric - 2 - Copy - Copy"
                },
                {
                  "type": 10,
                  "content": {
                    "chartId": "workbookd3a2514f-1058-46f7-ad25-c4948b34c8a9",
                    "version": "MetricsItem/2.0",
                    "size": 0,
                    "chartType": 2,
                    "resourceType": "microsoft.containerservice/managedclusters",
                    "metricScope": 0,
                    "resourceParameter": "AKSCluster",
                    "resourceIds": [
                      "{AKSCluster}"
                    ],
                    "timeContextFromParameter": "TimeRange",
                    "timeContext": {
                      "durationMs": 172800000
                    },
                    "metrics": [
                      {
                        "namespace": "microsoft.containerservice/managedclusters",
                        "metric": "microsoft.containerservice/managedclusters-Pods-kube_pod_status_phase",
                        "aggregation": 4,
                        "splitBy": null,
                        "columnName": "Pods"
                      }
                    ],
                    "title": "Pod Count by Cluster",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "Subscription",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "Name",
                          "formatter": 13,
                          "formatOptions": {
                            "linkTarget": "Resource"
                          }
                        },
                        {
                          "columnMatch": "microsoft.containerservice/managedclusters-Nodes (PREVIEW)-node_cpu_usage_percentage Timeline",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "microsoft.containerservice/managedclusters-Nodes (PREVIEW)-node_cpu_usage_percentage",
                          "formatter": 1,
                          "numberFormat": {
                            "unit": 1,
                            "options": null
                          }
                        },
                        {
                          "columnMatch": "microsoft.containerservice/managedclusters-Nodes (PREVIEW)-node_memory_working_set_percentage Timeline",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "microsoft.containerservice/managedclusters-Nodes (PREVIEW)-node_memory_working_set_percentage",
                          "formatter": 1,
                          "numberFormat": {
                            "unit": 1,
                            "options": null
                          }
                        },
                        {
                          "columnMatch": ".*\\/CPU Usage Percentage$",
                          "formatter": 1
                        },
                        {
                          "columnMatch": "microsoft.containerservice/managedclusters-Nodes-kube_node_status_condition Timeline",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "microsoft.containerservice/managedclusters-Nodes-kube_node_status_condition",
                          "formatter": 1,
                          "numberFormat": {
                            "unit": 0,
                            "options": null
                          }
                        },
                        {
                          "columnMatch": ".*\\/Statuses for various node conditions$",
                          "formatter": 1
                        }
                      ],
                      "rowLimit": 10000,
                      "labelSettings": [
                        {
                          "columnId": "Subscription",
                          "label": "Subscription"
                        }
                      ]
                    }
                  },
                  "customWidth": "40",
                  "name": "podsPerNode"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "\tresources\r\n\t| where type == \"microsoft.containerservice/managedclusters\"\r\n\t| extend  AKSname=name,location=location,AKSRG=tolower(resourceGroup),Sku=tostring(sku.name),Tier=tostring(sku.tier),AgentPoolProfiles=properties.agentPoolProfiles\r\n    | extend nodePoolCount = array_length(AgentPoolProfiles)\r\n\t| mvexpand AgentPoolProfiles\r\n\t| extend ProfileName = tostring(AgentPoolProfiles.name) ,mode=AgentPoolProfiles.mode,AutoScaleEnabled = AgentPoolProfiles.enableAutoScaling ,SpotVM=AgentPoolProfiles.scaleSetPriority,  VMSize=tostring(AgentPoolProfiles.vmSize),minCount=tostring(AgentPoolProfiles.minCount),maxCount=tostring(AgentPoolProfiles.maxCount) , nodeCount=tostring(AgentPoolProfiles.['count']), maxPods=tostring(AgentPoolProfiles.maxPods)\r\n    | project id,ProfileName,Sku,Tier,mode,AutoScaleEnabled,SpotVM, VMSize,nodeCount,minCount,maxCount, AKSname, maxPods, nodePoolCount\r\n    | extend SpotVM = iff(mode == \"System\", \"NotApplicable\", SpotVM)\r\n    | extend SystemNodeSize = iff(VMSize matches regex \"([2-4])\", \"Rightsized\", \"Oversized\")\r\n    | extend SystemPoolSizing = iff((mode == \"System\" and nodePoolCount > 1 ), SystemNodeSize, \"\")\r\n    | project id,ProfileName,Sku,Tier,mode,SystemPoolSizing, AutoScaleEnabled,SpotVM, VMSize, nodeCount,minCount,maxCount, AKSname, maxPods\r\n\r\n",
                    "size": 2,
                    "title": "AKS Cluster Audit",
                    "noDataMessage": "You have no AKS clusters!",
                    "showExportToExcel": true,
                    "queryType": 1,
                    "resourceType": "microsoft.resourcegraph/resources",
                    "crossComponentResources": [
                      "{Subscription}"
                    ],
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "$gen_group",
                          "formatter": 13,
                          "formatOptions": {
                            "linkTarget": "Resource",
                            "showIcon": true
                          }
                        },
                        {
                          "columnMatch": "id",
                          "formatter": 5,
                          "formatOptions": {
                            "linkTarget": "Resource",
                            "subTarget": "Insights"
                          }
                        },
                        {
                          "columnMatch": "mode",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "System",
                                "representation": "Gear",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "User",
                                "representation": "Person",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "success",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "SystemPoolSizing",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "representation": "more",
                                "text": ""
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Oversized",
                                "representation": "3",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Rightsized",
                                "representation": "success",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "more",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "AutoScaleEnabled",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "true",
                                "representation": "success",
                                "text": ""
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "disabled",
                                "text": ""
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "SpotVM",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "is Empty",
                                "representation": "3",
                                "text": "{0}{1}Not Spot VM"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "NotApplicable",
                                "representation": "more",
                                "text": ""
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "success",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "AKSname",
                          "formatter": 5
                        }
                      ],
                      "filter": true,
                      "hierarchySettings": {
                        "treeType": 1,
                        "groupBy": [
                          "id"
                        ],
                        "expandTopLevel": true
                      }
                    },
                    "sortBy": []
                  },
                  "conditionalVisibility": {
                    "parameterName": "show",
                    "comparison": "isEqualTo",
                    "value": "never"
                  },
                  "name": "full-aks-summary"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "KubePodInventory\r\n| where ContainerStatus == \"running\"\r\n| where isnotempty(Name)\r\n| distinct Name, Computer, ClusterId\r\n| extend NodePool = extract(@\"^(\\w+-\\w+)\", 0, Computer)\r\n| extend NodePool = trim_start(\"aks-\", NodePool)\r\n| summarize count(Name) by Computer, NodePool, ClusterId\r\n| summarize round(avg(count_Name), 0) by NodePool, ClusterId",
                    "size": 0,
                    "timeContextFromParameter": "TimeRange",
                    "queryType": 0,
                    "resourceType": "microsoft.containerservice/managedclusters",
                    "crossComponentResources": [
                      "{AKSCluster}"
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "nervershow",
                    "comparison": "isEqualTo",
                    "value": "true"
                  },
                  "name": "podCounts"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"12a02ca8-4356-49d8-90bc-ded8373c1068\",\"mergeType\":\"rightouter\",\"leftTable\":\"full-aks-summary\",\"rightTable\":\"podCounts\",\"leftColumn\":\"ProfileName\",\"rightColumn\":\"NodePool\"}],\"projectRename\":[{\"originalName\":\"[full-aks-summary].id\",\"mergedName\":\"id\",\"fromId\":\"12a02ca8-4356-49d8-90bc-ded8373c1068\"},{\"originalName\":\"[full-aks-summary].ProfileName\",\"mergedName\":\"ProfileName\",\"fromId\":\"12a02ca8-4356-49d8-90bc-ded8373c1068\"},{\"originalName\":\"[full-aks-summary].Sku\",\"mergedName\":\"Sku\",\"fromId\":\"12a02ca8-4356-49d8-90bc-ded8373c1068\"},{\"originalName\":\"[full-aks-summary].Tier\",\"mergedName\":\"Tier\",\"fromId\":\"12a02ca8-4356-49d8-90bc-ded8373c1068\"},{\"originalName\":\"[full-aks-summary].mode\",\"mergedName\":\"mode\",\"fromId\":\"12a02ca8-4356-49d8-90bc-ded8373c1068\"},{\"originalName\":\"[full-aks-summary].SystemPoolSizing\",\"mergedName\":\"SystemPoolSizing\",\"fromId\":\"12a02ca8-4356-49d8-90bc-ded8373c1068\"},{\"originalName\":\"[full-aks-summary].AutoScaleEnabled\",\"mergedName\":\"AutoScaleEnabled\",\"fromId\":\"12a02ca8-4356-49d8-90bc-ded8373c1068\"},{\"originalName\":\"[full-aks-summary].SpotVM\",\"mergedName\":\"SpotVM\",\"fromId\":\"12a02ca8-4356-49d8-90bc-ded8373c1068\"},{\"originalName\":\"[full-aks-summary].VMSize\",\"mergedName\":\"VMSize\",\"fromId\":\"12a02ca8-4356-49d8-90bc-ded8373c1068\"},{\"originalName\":\"[full-aks-summary].nodeCount\",\"mergedName\":\"nodeCount\",\"fromId\":\"12a02ca8-4356-49d8-90bc-ded8373c1068\"},{\"originalName\":\"[full-aks-summary].minCount\",\"mergedName\":\"minCount\",\"fromId\":\"12a02ca8-4356-49d8-90bc-ded8373c1068\"},{\"originalName\":\"[full-aks-summary].maxCount\",\"mergedName\":\"maxCount\",\"fromId\":\"12a02ca8-4356-49d8-90bc-ded8373c1068\"},{\"originalName\":\"[full-aks-summary].AKSname\",\"mergedName\":\"AKSname\",\"fromId\":\"12a02ca8-4356-49d8-90bc-ded8373c1068\"},{\"originalName\":\"[full-aks-summary].maxPods\",\"mergedName\":\"maxPods\",\"fromId\":\"12a02ca8-4356-49d8-90bc-ded8373c1068\"},{\"originalName\":\"[podCounts].NodePool\",\"mergedName\":\"NodePool\",\"fromId\":\"12a02ca8-4356-49d8-90bc-ded8373c1068\"},{\"originalName\":\"[podCounts].ClusterId\",\"mergedName\":\"ClusterId\",\"fromId\":\"12a02ca8-4356-49d8-90bc-ded8373c1068\"},{\"originalName\":\"[podCounts].avg_count_Name\",\"mergedName\":\"avg_count_Name\",\"fromId\":\"12a02ca8-4356-49d8-90bc-ded8373c1068\"}]}",
                    "size": 3,
                    "title": "AKS Cluster Review",
                    "queryType": 7,
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "$gen_group",
                          "formatter": 13,
                          "formatOptions": {
                            "linkTarget": "Resource",
                            "showIcon": true
                          }
                        },
                        {
                          "columnMatch": "Group",
                          "formatter": 13,
                          "formatOptions": {
                            "linkTarget": "Resource",
                            "showIcon": true
                          }
                        },
                        {
                          "columnMatch": "id",
                          "formatter": 5,
                          "formatOptions": {
                            "linkTarget": "Resource"
                          }
                        },
                        {
                          "columnMatch": "mode",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "System",
                                "representation": "Gear",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "User",
                                "representation": "Person",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "unknown",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "SystemPoolSizing",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "representation": "more",
                                "text": ""
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Oversized",
                                "representation": "3",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Rightsized",
                                "representation": "success",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "success",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "AutoScaleEnabled",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "true",
                                "representation": "success",
                                "text": ""
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "disabled",
                                "text": ""
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "SpotVM",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "is Empty",
                                "representation": "error",
                                "text": "{0}{1}Not Spot VM"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "NotApplicable",
                                "representation": "more",
                                "text": ""
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "success",
                                "text": ""
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "nodeCount",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "AKSname",
                          "formatter": 13,
                          "formatOptions": {
                            "linkTarget": "Resource",
                            "showIcon": true
                          }
                        },
                        {
                          "columnMatch": "NodePool",
                          "formatter": 5
                        },
                        {
                          "columnMatch": "ClusterId",
                          "formatter": 13,
                          "formatOptions": {
                            "linkTarget": "Resource",
                            "showIcon": true
                          }
                        }
                      ],
                      "filter": true,
                      "hierarchySettings": {
                        "treeType": 1,
                        "groupBy": [
                          "AKSname"
                        ],
                        "expandTopLevel": true
                      },
                      "labelSettings": [
                        {
                          "columnId": "minCount",
                          "label": "nodeMinCount"
                        },
                        {
                          "columnId": "maxCount",
                          "label": "nodeMaxCount"
                        },
                        {
                          "columnId": "avg_count_Name",
                          "label": "avgPods"
                        }
                      ]
                    }
                  },
                  "showPin": false,
                  "name": "query - 9"
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "costTab",
              "comparison": "isEqualTo",
              "value": "aks"
            },
            "name": "costAKSGroup"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "mainTab",
        "comparison": "isEqualTo",
        "value": "costOpt"
      },
      "name": "costOptimisationGroup"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "# Practical Examples\r\n\r\nThe below panels provides some real world examples and ideas on how to use Azure services to implement FinOps practices."
            },
            "name": "text - 0"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "Reduce Data",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "#### Ingestion\r\n\r\nThe benfit of using the cloud is that you pay for what you consume. Therefore by reducing the consumption of data for services you can reduce the cost. Some examples of this are:\r\n\r\n1. Use [Data Collection Rules](https://learn.microsoft.com/en-us/azure/azure-monitor/essentials/data-collection-rule-overview) for Log Analytics and Sentinel to filter data before it's ingested (reducing data ingested).\r\n2. Configuring [Daily Ingestion caps](https://learn.microsoft.com/en-us/azure/azure-monitor/logs/daily-cap) on Log Analytics workspaces. This prevents accident bilshock from a workload over-generating logs (e.g. crashing applications or unknown events).\r\n3. Enable [ingestion sampling](https://learn.microsoft.com/en-us/azure/azure-monitor/app/sampling) on Application Insights to reduce the amount of data captured by applications.\r\n4. Ensure [Diagnostic Settings](https://learn.microsoft.com/en-us/azure/azure-monitor/essentials/diagnostic-settings) aren't exported to duplicate locations and `metrics` are only exported if they're needed for greater then the default retention.\r\n\r\n"
                  },
                  "customWidth": "50",
                  "name": "text - 5",
                  "styleSettings": {
                    "padding": "10px"
                  }
                },
                {
                  "type": 1,
                  "content": {
                    "json": "#### Retention\r\n\r\n1. Verify Log Analytics Workspace retention periods are set correctly (specify for Individual Tables where applicable).\r\n2. Leverage Log Analytics Workspaces basic log options. \r\n3. Reduce storage durability for lower environments or duplicate data (anything that could be reproduced or isn't the original source) - StorageAccounts, Backups, etc.\r\n4. Understand your organizations data retention requirements and have a plan to archive data from Azure Data sources (SQL, Tables, Cosmos, etc)."
                  },
                  "customWidth": "50",
                  "name": "text - 1"
                }
              ]
            },
            "name": "reduceIngestionText",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "Automation",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "#### Azure Policies\r\n\r\nAzure Policies can be used to  `audit`, `deny` or `remediate` existing or new resources based on their configuration. This can be useful for enforcing general cost savings advice for teams. Some ideas for this are:\r\n\r\n1. Deploy Life Cycle Policies to storage accounts based on the environment: [Life Cycle Policy](https://github.com/Azure/Community-Policy/tree/master/Policies/Storage/deploy-storage-account-lifecycle-management).\r\n2. Enable Hybrid Benefits automatically for resources: [Hybrid Benefit Policies](https://github.com/Azure/Community-Policy/tree/master/Policies/HybridUseBenefits).\r\n3. Enforce tagging standards for resources / resource groups: [Tagging Policies](https://github.com/Azure/Community-Policy/tree/master/Policies/General).\r\n4. Set Application Insights Sampling in lower environments.\r\n5. Reduce the redundancy / durability of resources in lower environments (where applicable).\r\n  - Example: Change storageaccounts in `dev/test/poc` to LRS (3 copies of the data).\r\n"
                  },
                  "customWidth": "50",
                  "name": "text - 1",
                  "styleSettings": {
                    "padding": "10px"
                  }
                },
                {
                  "type": 1,
                  "content": {
                    "json": "#### Runbooks\r\n\r\n\r\nAzure Runbooks can be configured to execute tasks/scripts to govern Azure resources. Some ideas for this are:\r\n\r\n1. Tagging resources in POC or Sandbox environments to mark them for deletion. Then automatically cleaning them up after a set duration. \r\n2. Stopping AKS clusters (or just node pools) in lower environments after hours and on the weekends. \r\n3. Scaling down specific workloads within an AKS cluster (if you can't shutdown a nodepool).\r\n4. Setting storageaccounts to the `standard` SKU for lower environments.\r\n5. [Use Azure Budgets to trigger a Runbook](https://learn.microsoft.com/en-us/azure/cost-management-billing/manage/cost-management-budget-scenario)\r\n6. Running the [Log Analytics SKU recommendation](https://learn.microsoft.com/en-us/azure/azure-monitor/logs/cost-logs#evaluate-the-legacy-per-node-pricing-tier) query against LAWs to determine the correct commitment tier. Alert based on any recommendation changes.\r\n7. Automate creating default budgets for new Resource Groups. Leveraging the Azure tags for Technical and Business contacts. \r\n8. Stop / Start Synaps and Databases."
                  },
                  "customWidth": "50",
                  "name": "text - 2",
                  "styleSettings": {
                    "padding": "10px"
                  }
                },
                {
                  "type": 1,
                  "content": {
                    "json": "#### Opt Out\r\n\r\nCloud cost automation and recommendations are generalised. It isn't applicable to every workload, so ensure that there's an opt-out approach. Teams should be able to exempt there resources from automated / standardised processes. \r\n\r\n1. Use tags on the resource to exempt it from a process (policy or automation).\r\n2. Provide self-service opt-out options."
                  },
                  "customWidth": "50",
                  "name": "text - 3",
                  "styleSettings": {
                    "padding": "10px"
                  }
                },
                {
                  "type": 1,
                  "content": {
                    "json": "#### Alerts\r\n\r\nSetup alerts for low resource utilisation. \r\n\r\n1. Virtual Machine with **5%** CPU usage for 10 days.\r\n2. AKS cluster with low node utilisation (< **10%** CPU and Memory usage).\r\n3. SQL servers with minimal utilisation ( < **10%** utilisation).\r\n4. New Advisor Cost recommendation.\r\n5. Virtual Machines or App Services that are stopped.\r\n6. Monitor Storage Tier cost for Storage accounts to ensure the right access tier is configured (e.g. an abundance of Cool reads)."
                  },
                  "customWidth": "50",
                  "name": "text - 3"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "#### Infrastructure As Code\r\n\r\nTools can be used to scan Cloud Infrastructure As Code configuration and identify potential Cost Optimisation opportunities before the resource is created. \r\n\r\n1. Use [PSRule for Azure](https://azure.github.io/PSRule.Rules.Azure) to scan Infrastructure As Code (ARM, Bicep) for any Well Architected Framework Cost Optimisation recommendations. \r\n2. The Terraform VSCode extension for [cost estimates](https://github.com/infracost/vscode-infracost). \r\n3. Reduced effort and simplicity when deploying resources to Azure."
                  },
                  "customWidth": "50",
                  "name": "text - 4"
                }
              ]
            },
            "name": "AutomationTextGroup",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "Operational Excellence",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "#### Workshops & Training\r\n\r\n1. Organize training or workshops for teams using the cloud so they better understand Cloud Economics and leavers.\r\n2. Complete the free Microsoft Online Training\r\n  - [Azure Cost Fundamentals](https://learn.microsoft.com/en-us/training/paths/describe-azure-management-governance/)\r\n  - [Control Azure Spend](https://learn.microsoft.com/en-us/training/paths/control-spending-manage-bills/)\r\n  - [Savings Plans](https://learn.microsoft.com/en-us/training/paths/control-spending-manage-bills/)\r\n  - [AutoScaling Tutorial](https://learn.microsoft.com/en-us/training/modules/app-service-autoscale-rules/)\r\n3. Engagement Microsoft or a partner for instructor lead training\r\n4. Host internal lunch & learns to share wins"
                  },
                  "customWidth": "50",
                  "name": "text - 1"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "#### Rightsizing\r\n\r\nEvery month dedicate time to evaluate a `right sizing` dashboard / tools recommendations. This ensures the costs and resource consumption of resources are actively reviewed. This session should also review and supress or action any Azure Advisor recommendations.  \r\n\r\nResources To Rightsize:\r\n1. SQL\r\n2. Redis\r\n3. CosmosDB (Manual or Autoscale)\r\n4. Virtual Machines\r\n5. App Service Plans"
                  },
                  "customWidth": "50",
                  "name": "text - 8",
                  "styleSettings": {
                    "padding": "10px"
                  }
                },
                {
                  "type": 1,
                  "content": {
                    "json": "#### Advisor Recommendations\r\n\r\n1. Setup alerts for Advisor recommendations to relevant stakeholders.\r\n2. Bi-Weekly Advisor / Azure review session (1-hour meeting)."
                  },
                  "customWidth": "50",
                  "name": "text - 2"
                }
              ]
            },
            "name": "operationalExcellenceGroup",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "Governance",
              "items": [
                {
                  "type": 1,
                  "content": {
                    "json": "#### Organization Standards\r\n\r\n1. Reliability / Availability requirements for lower environments.\r\n2. Enforcing tagging standards (costcentre, department, billingOwner, etc)\r\n"
                  },
                  "customWidth": "50",
                  "name": "text - 1"
                },
                {
                  "type": 1,
                  "content": {
                    "json": "#### Compute Savings Plans / Reservations\r\n\r\n1.  [Azure Reservations](https://azure.microsoft.com/en-ca/reservations/) are the ability to commit to using a resource for **1** or **3** years and you'll receive a discount off the normal rates. Reservations can be purchased for over **22** different services in Azure.\r\n2. [Compute Saving Plans](https://learn.microsoft.com/en-us/azure/cost-management-billing/savings-plan/savings-plan-compute-overview) allow you to ***"
                  },
                  "customWidth": "50",
                  "name": "text - 7",
                  "styleSettings": {
                    "padding": "10px"
                  }
                }
              ]
            },
            "name": "governanceTextGroup",
            "styleSettings": {
              "showBorder": true
            }
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "mainTab",
        "comparison": "isEqualTo",
        "value": "practicalExamples"
      },
      "name": "practicalExamplesGroup"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "# Overview\r\n\r\nThis workbook provides insights into implementing and managing FinOps in Azure. It's meant to be used as a quickstart for anyone using the Cloud. \r\n\r\n## Guidance\r\n\r\nFinOps is a continual journey that requires a collaborative effort from an organizations technology team. Cost Optmization is important, but it's only part of the FinOps journey. We also need to look at governance controls, proative monitoring, improving cost visibility and ensure that teams have the required skills to optimize their Cloud spend. \r\n\r\n\r\nThe following links provide perscriptive guidance and recommendations on optimising your Azure costs. \r\n\r\n- [Azure Cloud Adoption Framework - Cost Best Practices](https://learn.microsoft.com/en-gb/azure/cloud-adoption-framework/govern/cost-management/best-practices)\r\n- [Azure Well Architected Framework - Cost Pillar](https://learn.microsoft.com/en-us/azure/architecture/framework/cost/)\r\n- [FinOps Foundation](https://www.finops.org/introduction/what-is-finops/)\r\n\r\n### Workbook Breakdown\r\n\r\n- **Governance**: Audits the use of Azure goverance tools that enable FinOps. \r\n- **Visualization**: Check that visualization services are in use and provides recommendations for using PowerBI and the Cost Management Billing service. \r\n- **Cost Optimization**: Insights into common Azure services and references on how to optimize the cost. \r\n- **Practical Examples**: Examples on how to use Azure Services to enforce and automate FinOps practices.\r\n\r\n> Note: All panels in the dashboard come with a `download to xlsx` button (top right), so the data can be exported.\r\n\r\n### Workbook Requirements\r\n\r\n- `Read Only` Azure RBAC access over the subscription and resources you're investigating.\r\n\r\n### Free Online Training\r\n\r\nFree publicly available training provided by Microsoft.\r\n\r\n  - [Azure Cost Fundamentals](https://learn.microsoft.com/en-us/training/paths/describe-azure-management-governance/)\r\n  - [Control Azure Spend](https://learn.microsoft.com/en-us/training/paths/control-spending-manage-bills/)\r\n  - [Implement FinOps for Azure](https://info.microsoft.com/ww-ondemand-implement-finops-for-azure.html?lcid=en-us)\r\n\r\n### Additional Resources\r\n\r\nThe following articles are published on the Microsoft tech blogs and Ignite videos.\r\n\r\n- Cost Optimisation In the Cloud - [part 1](https://techcommunity.microsoft.com/t5/azure-architecture-blog/part-1-cost-optimisation-in-the-cloud-practical-design-steps-for/ba-p/3574431), [part 2](https://techcommunity.microsoft.com/t5/azure-architecture-blog/part-2-infra-cost-optimisation-in-the-cloud-practical-design/ba-p/3602797) & [part 3](https://techcommunity.microsoft.com/t5/azure-architecture-blog/part-3-architectural-cost-optimisation-practical-design-steps/ba-p/3708993)\r\n- [Azure Cost Optimisation](https://techcommunity.microsoft.com/t5/azure-architecture-blog/azure-cost-optimisation/ba-p/3624817)\r\n- [How to reduce your Azure Invoice](https://techcommunity.microsoft.com/t5/azure/how-to-reduce-your-azure-invoice/m-p/3686772)\r\n- [Optimize your investment on Azure](https://www.youtube.com/watch?v=JebcsGuYc7E)\r\n- [Azure FinOps Guide - 2023](https://techcommunity.microsoft.com/t5/fasttrack-for-azure/the-azure-finops-guide/ba-p/3704132)\r\n\r\n\r\n\r\n"
            },
            "name": "text - 0"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "mainTab",
        "comparison": "isEqualTo",
        "value": "overview"
      },
      "name": "costOverview"
    }
  ],
  "fallbackResourceIds": [
    "azure monitor"
  ],
  "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
}